import{s as e}from"./rolldown-runtime-B6ubh40S.js";import{N as t,P as n,k as r}from"./chakra-ui-DL3iEWi3.js";import{n as i,t as a}from"./react-syntax-highlighter-ulWaH-7J.js";import"./excalidraw-1r7A58jz.js";import"./react-utils-16xY-tCv.js";import{Ft as o,It as s,Lt as c,Qt as l,Ut as u,Wt as d}from"./zenmark-editor-oLEUU1ik.js";import"./vendor-B06hKXvc.js";import"./common-utils-BE1DbrSU.js";import{t as f}from"./react-markdown-Dc1ste6M.js";import{t as p}from"./remark-gfm-CWYf_crh.js";import{At as m,Bt as h,Ct as g,Dt as _,Ft as v,Gt as y,Ht as b,It as x,Kt as S,Lt as ee,Ot as C,Rt as w,St as te,Ut as T,Vt as E,Wt as D,_t as O,a as k,bt as A,c as j,ct as M,d as ne,dt as re,f as ie,ft as ae,gt as N,i as P,kt as oe,l as se,lt as F,n as ce,o as le,pt as ue,qt as de,s as fe,t as pe,ut as me,vt as he,yt as ge,zt as _e}from"./app-4W9mSKOM.js";import{a as ve,i as ye,t as be}from"./excalidraw-runtime-B59Sb5pu.js";function xe(e,t,n,r,i,a,o,s){var c=[],l=0,u=0,d=!1,f=function(){d&&!c.length&&!l&&t.complete()},p=function(e){return l<r?m(e):c.push(e)},m=function(e){a&&t.next(e),l++;var s=!1;D(n(e,u++)).subscribe(S(t,function(e){i?.(e),a?p(e):t.next(e)},function(){s=!0},void 0,function(){if(s)try{l--;for(var e=function(){var e=c.shift();o?T(t,o,function(){return m(e)}):m(e)};c.length&&l<r;)e();f()}catch(e){t.error(e)}}))};return e.subscribe(S(t,p,function(){d=!0,f()})),function(){s?.()}}function Se(e,t,n){return n===void 0&&(n=1/0),l(t)?Se(function(n,r){return h(function(e,i){return t(n,e,r,i)})(D(e(n,r)))},n):(typeof t==`number`&&(n=t),de(function(t,r){return xe(t,r,e,n)}))}function Ce(e,t,n,r,i){return function(a,o){var s=n,c=t,l=0;a.subscribe(S(o,function(t){var n=l++;c=s?e(c,t,n):(s=!0,t),r&&o.next(c)},i&&(function(){s&&o.next(c),o.complete()})))}}function we(e,t){return de(Ce(e,t,arguments.length>=2,!0))}var Te=m(`ArrowUp`,[[`path`,{d:`m5 12 7-7 7 7`,key:`hav0vg`}],[`path`,{d:`M12 19V5`,key:`x0mq9r`}]]),Ee=m(`Square`,[[`rect`,{width:`18`,height:`18`,x:`3`,y:`3`,rx:`2`,key:`afitv7`}]]),I=e(n(),1),De=8e3;const Oe=new class{async getCurrentPageContext(){let e=A.pageBox.getCurrentPage?.();if(!e)return;let t=e.viewData;return{uri:t?.props?.uri,openerId:t?.type}}async getEditorContext(){let e=await this.getCurrentPageContext();if(!e?.uri)return;let t=e.uri;try{let e=await j.service.read(t),n=t.split(`/`).pop()||t;return{uri:t,fileName:n,content:e,language:this.detectLanguage(n),lineCount:e.split(`
`).length}}catch(e){console.warn(`Failed to read file for context:`,e);return}}async getBrowserTabContext(){if(typeof window>`u`)return;let e=window.chrome;if(!(!e||!e.tabs))try{let t=await e.tabs.query({active:!0,currentWindow:!0});if(t.length===0||!t[0]?.url)return;let n=t[0],r=n.url;return r?{url:r,title:n.title||``}:void 0}catch(e){console.warn(`Failed to get browser tab context:`,e);return}}async getFullContext(e){let{includeBrowserTab:t=!0,includeEditor:n=!0,includeProject:r=!1}=e||{},i={timestamp:Date.now()};return t&&(i.browserTab=await this.getBrowserTabContext()),n&&(i.editor=await this.getEditorContext()),r&&(i.project=await this.getProjectContext()),i}formatContextForPrompt(e){let t=O.t.bind(O),n=[];if(e.browserTab&&(n.push(`## ${t(`globalChat.currentBrowserTab`)}`),n.push(`- ${t(`globalChat.url`)}: ${e.browserTab.url}`),n.push(`- ${t(`globalChat.title`)}: ${e.browserTab.title}`),e.browserTab.selectedText&&n.push(`- ${t(`globalChat.selectedText`)}: ${e.browserTab.selectedText}`),n.push(``)),e.editor){n.push(`## ${t(`globalChat.currentEditor`)}`),n.push(`- ${t(`globalChat.file`)}: ${e.editor.fileName}`),n.push(`- ${t(`globalChat.path`)}: ${e.editor.uri}`),e.editor.language&&n.push(`- ${t(`globalChat.language`)}: ${e.editor.language}`),n.push(`- ${t(`globalChat.lineCount`)}: ${e.editor.lineCount}`),e.editor.selectedText&&n.push(`- ${t(`globalChat.selectedText`)}: ${e.editor.selectedText}`),n.push(``),n.push(`### ${t(`globalChat.fileContent`)}`);let r=e.editor.content;r.length>De&&(r=r.slice(0,De),n.push(`(${t(`globalChat.fileContentTruncated`,{shown:De.toLocaleString(),total:e.editor.content.length.toLocaleString()})})`)),n.push("```"+(e.editor.language||``)+`
`+r+"\n```"),n.push(``)}return e.project&&(e.project.currentFile&&n.push(`## ${t(`globalChat.currentProjectFile`)}: ${e.project.currentFile}`),e.project.recentFiles&&e.project.recentFiles.length>0&&(n.push(`## ${t(`globalChat.recentFiles`)}`),e.project.recentFiles.forEach(e=>{n.push(`- ${e}`)}),n.push(``))),n.join(`
`)}detectLanguage(e){return{ts:`typescript`,tsx:`typescript`,js:`javascript`,jsx:`javascript`,py:`python`,java:`java`,cpp:`cpp`,c:`c`,go:`go`,rs:`rust`,php:`php`,rb:`ruby`,swift:`swift`,kt:`kotlin`,md:`markdown`,json:`json`,yaml:`yaml`,yml:`yaml`,xml:`xml`,html:`html`,css:`css`,scss:`scss`,sass:`sass`,sql:`sql`,sh:`bash`,bash:`bash`,zsh:`bash`}[e.split(`.`).pop()?.toLowerCase()||``]||`text`}async getProjectContext(){return{currentFile:(await this.getEditorContext())?.uri}}};function ke(){let[e,t]=(0,I.useState)(null),[n,r]=(0,I.useState)(null);return(0,I.useEffect)(()=>{let e=!1,n=async()=>{try{let n=(await Oe.getCurrentPageContext())?.uri;if(e)return;if(n){t(ge.getSpaceIdFromUri(n));let i=await Oe.getEditorContext();i&&!e?r(Oe.formatContextForPrompt({editor:i,timestamp:Date.now()})):e||r(null)}else e||(t(null),r(null))}catch{e||(t(null),r(null))}};n();let i=A.pageBox.currentPage$?.subscribe(()=>{e||n()});return()=>{e=!0,i?.unsubscribe()}},[]),(0,I.useMemo)(()=>{let t=[];return e&&t.push({description:`current_space_id`,value:e}),n&&t.push({description:`current_file_context`,value:n}),t},[e,n])}var L={TEXT_START:`TEXT_START`,TEXT_DELTA:`TEXT_DELTA`,TEXT_END:`TEXT_END`,TOOL_CALL_START:`TOOL_CALL_START`,TOOL_CALL_ARGS:`TOOL_CALL_ARGS`,TOOL_CALL_ARGS_DELTA:`TOOL_CALL_ARGS_DELTA`,TOOL_CALL_END:`TOOL_CALL_END`,TOOL_CALL_RESULT:`TOOL_CALL_RESULT`,RUN_STARTED:`RUN_STARTED`,RUN_FINISHED:`RUN_FINISHED`,RUN_ERROR:`RUN_ERROR`};function R(e,t){t&&e.push(t)}function Ae(e,t){let n=[],r=t.choices?.[0],i=r?.delta??{};i.content&&(e.textStarted||R(n,{type:L.TEXT_START,messageId:e.messageId}),R(n,{type:L.TEXT_DELTA,messageId:e.messageId,delta:i.content}),e.textStarted=!0);let a=Array.isArray(i.tool_calls)?i.tool_calls:[];for(let t of a){let r=t.index,i=e.toolCalls.get(r)??{id:``,name:``,args:``,started:!1,ended:!1},a=i.id||t.id||``,o=i.name||t.function?.name||``,s=t.function?.arguments||``;s&&(i.args+=s),!i.id&&a&&(i.id=a),!i.name&&o&&(i.name=o),!i.started&&i.id?(R(n,{type:L.TOOL_CALL_START,toolCallId:i.id,toolName:i.name}),i.args&&R(n,{type:L.TOOL_CALL_ARGS_DELTA,toolCallId:i.id,argsDelta:i.args}),i.started=!0):s&&i.started&&R(n,{type:L.TOOL_CALL_ARGS_DELTA,toolCallId:i.id,argsDelta:s}),e.toolCalls.set(r,i)}if(r?.finish_reason===`tool_calls`){e.textStarted&&!e.textEnded&&(R(n,{type:L.TEXT_END,messageId:e.messageId}),e.textEnded=!0);for(let t of e.toolCalls.values())t.started&&!t.ended&&(R(n,{type:L.TOOL_CALL_END,toolCallId:t.id}),t.ended=!0)}return e.stepEvents=n,e}function je(e,t){let n={messageId:t.messageId,textStarted:!1,textEnded:!1,toolCalls:new Map,stepEvents:[]},r=b(e).pipe(we((e,t)=>Ae(e,t),n),Se(e=>b(e.stepEvents)),_e(e=>E({type:L.RUN_ERROR,error:String(e?.message||e),threadId:t.threadId})),w(()=>{}));return new d(e=>{e.next({type:L.RUN_STARTED,threadId:t.threadId});let n=r.subscribe({next:t=>e.next(t),error:t=>e.error(t),complete:()=>{e.next({type:L.RUN_FINISHED,threadId:t.threadId}),e.complete()}});return()=>n.unsubscribe()})}var Me=class{run(e){let t=e.runId||e.threadId||`agent-${Date.now().toString(36)}`,n=Le(Ne(e.messages,e.context)),r=Re(e.tools);return new d(i=>{let a=null;return ue.chatStreamChunks({messages:n,tools:r}).then(n=>{a=je(n,{messageId:t,threadId:e.threadId}).subscribe({next:e=>i.next(e),error:e=>i.error(e),complete:()=>i.complete()})}).catch(t=>{i.next({type:`RUN_ERROR`,error:t instanceof Error?t.message:String(t),threadId:e.threadId}),i.error(t)}),()=>{a?.unsubscribe()}})}abortRun(){}};function Ne(e,t){let n=[];if(n.push({role:`system`,content:`你是一个项目内的 AI 助手。你可以查看当前页面信息，并在需要时调用可用的工具（例如文件系统工具、工作区上下文工具和 Excalidraw 图表工具）来辅助用户操作。`}),t&&t.length){let e=t.map(e=>`${e.description}:\n${e.value}`).join(`

`);n.push({role:`system`,content:e})}let r=e.filter(e=>e.role!==`data`).map(e=>e.parts.map((t,n)=>Pe(e,t,n)).flat()).flat();return n.concat(r)}function Pe(e,t,n){let{role:r}=e,i=[];if(t.type===`text`)i.push({role:r,content:t.text});else if(t.type===`tool-invocation`){let e=t.toolInvocation,n=e.args,r;if(typeof n==`string`)try{let e=JSON.parse(n);r=e&&typeof e==`object`?n:JSON.stringify({value:e})}catch{r=JSON.stringify({value:n})}else r=JSON.stringify(n??{});let a={role:`assistant`,content:``,toolCalls:[{id:e.toolCallId,type:`function`,function:{name:e.toolName,arguments:r}}]},o=e.error&&typeof e.error==`string`?{error:e.error}:e.result??{},s={role:`tool`,name:e.toolCallId,content:JSON.stringify(o)};i.push(a,s)}return i}var Fe=3e4,Ie=1e4;function Le(e,t=Fe){if(!e.length)return e;let n=e.filter(e=>e.role===`system`),r=e.filter(e=>e.role!==`system`),i=(e,t)=>e.length>t?e.slice(0,t):e,a=t,o=[],s=e=>{if(e.role===`tool`||e.toolCalls?.length){o.push(e);return}let t=e.content??``;if(a<=0){o.push({...e,content:``});return}if(!t){o.push(e);return}let n=i(t,Ie);n.length>a&&(n=n.slice(n.length-a)),a-=n.length,o.push({...e,content:n})};for(let e of n)if(s(e),a<=0)return o;let c=[];for(let e=r.length-1;e>=0;e--)c.push(r[e]);c.reverse();for(let e of c)s(e);return o}function Re(e){if(!(!e||e.length===0))return e.map(e=>({type:`function`,function:{name:e.name,description:e.description,parameters:e.parameters}}))}const ze=new Me;function Be(e){let[t,n]=(0,I.useState)(e.getValue());return(0,I.useEffect)(()=>{let t=e.subscribe(n);return()=>t.unsubscribe()},[e]),t}var Ve=(e,t)=>{let[n,r]=(0,I.useState)(t);return(0,I.useEffect)(()=>{let t=e.subscribe(r);return()=>t.unsubscribe()},[e]),n},z=function(e){return e.CALL=`call`,e.RESULT=`result`,e.PARTIAL_CALL=`partial-call`,e.ERROR=`error`,e.CANCELLED=`cancelled`,e}({}),B=function(e){return e.TEXT_START=`TEXT_START`,e.TEXT_DELTA=`TEXT_DELTA`,e.TEXT_END=`TEXT_END`,e.TOOL_CALL_START=`TOOL_CALL_START`,e.TOOL_CALL_ARGS=`TOOL_CALL_ARGS`,e.TOOL_CALL_ARGS_DELTA=`TOOL_CALL_ARGS_DELTA`,e.TOOL_CALL_END=`TOOL_CALL_END`,e.TOOL_CALL_RESULT=`TOOL_CALL_RESULT`,e.RUN_STARTED=`RUN_STARTED`,e.RUN_FINISHED=`RUN_FINISHED`,e.RUN_ERROR=`RUN_ERROR`,e}({}),He=e=>{try{return JSON.parse(e)}catch{return}},Ue=e=>({toolCallId:e.id,toolName:e.function.name,args:e.function.arguments,parsedArgs:He(e.function.arguments),status:z.CALL});function We(e,t){let n=t?.stubResult??{error:`tool_call_interrupted`,note:`User continued before tool produced a result.`};return e.map(e=>e.parts?.length?{...e,parts:e.parts.map(e=>{if(e.type!==`tool-invocation`||![z.CALL,z.PARTIAL_CALL].includes(e.toolInvocation.status))return e;let t;if(typeof e.toolInvocation.args==`string`)try{t=JSON.parse(e.toolInvocation.args)}catch{return{...e,toolInvocation:{...e.toolInvocation,args:JSON.stringify({}),parsedArgs:t,status:z.RESULT,result:{error:`invalid_args`,raw:e.toolInvocation.args}}}}return{...e,toolInvocation:{...e.toolInvocation,args:e.toolInvocation.args,parsedArgs:t,status:z.RESULT,result:n}}})}:e)}var V=[];for(let e=0;e<256;++e)V.push((e+256).toString(16).slice(1));function Ge(e,t=0){return(V[e[t+0]]+V[e[t+1]]+V[e[t+2]]+V[e[t+3]]+`-`+V[e[t+4]]+V[e[t+5]]+`-`+V[e[t+6]]+V[e[t+7]]+`-`+V[e[t+8]]+V[e[t+9]]+`-`+V[e[t+10]]+V[e[t+11]]+V[e[t+12]]+V[e[t+13]]+V[e[t+14]]+V[e[t+15]]).toLowerCase()}var Ke,qe=new Uint8Array(16);function Je(){if(!Ke){if(typeof crypto>`u`||!crypto.getRandomValues)throw Error(`crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported`);Ke=crypto.getRandomValues.bind(crypto)}return Ke(qe)}var Ye={randomUUID:typeof crypto<`u`&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Xe(e,t,n){if(Ye.randomUUID&&!t&&!e)return Ye.randomUUID();e||={};let r=e.random??e.rng?.()??Je();if(r.length<16)throw Error(`Random bytes length must be >= 16`);if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,t){if(n||=0,n<0||n+16>t.length)throw RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[n+e]=r[e];return t}return Ge(r)}var Ze=Xe,Qe=class{disposables=[];addDisposable=e=>{this.disposables.push(e)};dispose=()=>{this.disposables.forEach(e=>e()),this.disposables=[]}},$e=class extends Qe{_messages$=new y([]);messages$;threadId$=new y(null);isAgentResponding$=new y(!1);agentRunSubscriptionRef=(0,I.createRef)();addMessagesEvent$=new u;updateMessageEvent$=new u;setMessagesEvent$=new u;toolCall$=new u;eventHandler=new et(this);constructor(e,t){super(),this.agentProvider=e;let{initialMessages:n=[]}=t||{};this._messages$.next(n),this.messages$=this._messages$.asObservable(),this.addDisposable(this.connectToolExecutor())}getMessages=()=>this._messages$.getValue();setMessages=e=>{this._messages$.next(e),this.setMessagesEvent$.next({messages:e})};handleEvent=e=>{this.eventHandler.handleEvent(e)};reset=()=>{this._messages$.next([]),this.eventHandler.reset(),this.threadId$.next(null),this.isAgentResponding$.next(!1),this.abortAgentRun()};addMessages=e=>{this._messages$.next([...this.getMessages(),...e]),this.addMessagesEvent$.next({messages:e})};removeMessages=e=>{e.length!==0&&this._messages$.next(this.getMessages().filter(t=>!e.includes(t.id)))};updateMessage=e=>{this._messages$.next(this.getMessages().map(t=>t.id===e.id?e:t)),this.updateMessageEvent$.next({message:e})};addToolResult=(e,t)=>{let n=this.getMessages().find(t=>t.parts.find(t=>t.type===`tool-invocation`&&t.toolInvocation.toolCallId===e.toolCallId));if(!n)return;let r={...n,parts:n.parts.map(t=>t.type===`tool-invocation`&&t.toolInvocation.toolCallId===e.toolCallId?{...t,toolInvocation:{...t.toolInvocation,result:e.result??void 0,status:e.status,error:e.error??void 0,cancelled:e.cancelled??void 0}}:t)};this.updateMessage(r)};handleAgentResponse=e=>{this.agentRunSubscriptionRef.current&&this.agentRunSubscriptionRef.current.unsubscribe(),this.agentRunSubscriptionRef.current=e.subscribe(e=>{this.handleEvent(e),(e.type===B.RUN_FINISHED||e.type===B.RUN_ERROR)&&(this.isAgentResponding$.next(!1),this.agentRunSubscriptionRef.current=null)})};abortAgentRun=()=>{this.agentProvider.agent.abortRun?.(),this.agentRunSubscriptionRef.current&&(this.agentRunSubscriptionRef.current.unsubscribe(),this.agentRunSubscriptionRef.current=null,this.isAgentResponding$.next(!1))};runAgent=async()=>{this.isAgentResponding$.next(!0);try{let e=We(this.getMessages()),t=await this.agentProvider.agent.run({threadId:this.threadId$.getValue()??``,runId:Ze(),messages:e,tools:this.agentProvider.getToolDefs(),context:this.agentProvider.getContexts()});this.handleAgentResponse(t)}catch(e){e?.name===`AbortError`?console.info(`Agent run aborted`):console.error(`Error running agent:`,e),this.isAgentResponding$.next(!1)}};handleAddToolResult=async(e,t)=>{let{triggerAgent:n=!0}=t||{};await this.addToolResult(e,{triggerAgent:n}),n&&await this.runAgent()};handleAddMessages=async(e,t)=>{let{triggerAgent:n=!0}=t||{};console.log(`[useAgentChat] addMessages`,e);try{this.addMessages(e),n&&await this.runAgent()}catch(e){console.error(`Error adding messages:`,e),n&&this.isAgentResponding$.next(!1)}};handleSendMessage=async e=>{e.trim()&&(this.addMessages([{id:Ze(),role:`user`,parts:[{type:`text`,text:e}]}]),await this.runAgent())};connectToolExecutor=()=>{let e=this.toolCall$.subscribe(async({toolCall:e})=>{let t=this.agentProvider.getToolExecutor(e.function.name);if(t)try{let n=await t(JSON.parse(e.function.arguments));this.addToolResult({toolCallId:e.id,result:n,status:z.RESULT}),this.runAgent()}catch(t){console.error(`[AgentChatController] handleAddToolResult error`,t),this.addToolResult({toolCallId:e.id,error:t instanceof Error?t.message:String(t),status:z.ERROR}),this.runAgent()}});return()=>e.unsubscribe()}},et=class{currentMessageId;currentMessageContent=``;currentToolCallId;currentToolCallName;currentToolCallArgs=``;emittedToolCallIds=new Set;constructor(e){this.sessionManager=e}reset(){this.currentMessageId=void 0,this.currentMessageContent=``,this.currentToolCallId=void 0,this.currentToolCallName=void 0,this.currentToolCallArgs=``,this.emittedToolCallIds.clear()}emitToolCallEvents(){let e=this.sessionManager.getMessages(),t=e[e.length-1];if(!(!t||t.role!==`assistant`||!t.parts))for(let e of t.parts){if(e.type!==`tool-invocation`)continue;let t=e.toolInvocation;t.status===z.CALL&&!this.emittedToolCallIds.has(t.toolCallId)&&(this.emittedToolCallIds.add(t.toolCallId),this.sessionManager.toolCall$.next({toolCall:{id:t.toolCallId,type:`function`,function:{name:t.toolName,arguments:t.args}}}))}}handleEvent(e){switch(console.log(`[AgentChatController] event`,e),e.type){case B.RUN_STARTED:break;case B.TEXT_START:this.handleTextStart(e);break;case B.TEXT_DELTA:this.handleTextContent(e);break;case B.TEXT_END:this.handleTextEnd();break;case B.TOOL_CALL_START:this.handleToolCallStart(e);break;case B.TOOL_CALL_ARGS_DELTA:this.handleToolCallArgsDelta(e);break;case B.TOOL_CALL_ARGS:this.handleToolCallArgs(e);break;case B.TOOL_CALL_END:this.handleToolCallEnd(),this.emitToolCallEvents();break;default:console.info(`Unknown event type:`,e.type);break}}handleTextStart(e){this.currentMessageId=e.messageId,this.currentMessageContent=``}updateTextPart(e,t){let n=e.parts?.[e.parts.length-1];return n&&n.type===`text`?{...e,parts:[...e.parts.slice(0,-1)||[],{type:`text`,text:t}]}:{...e,parts:[...e.parts||[],{type:`text`,text:t}]}}handleTextContent(e){if(!e.delta||this.currentMessageId!==e.messageId)return;this.currentMessageContent+=e.delta;let t=this.currentMessageContent,n=this.currentMessageId,r=this.sessionManager.getMessages(),i=r[r.length-1];i&&i.role===`assistant`&&i.id===n?this.sessionManager.updateMessage(this.updateTextPart(i,t)):this.sessionManager.addMessages([{id:n,role:`assistant`,parts:[{type:`text`,text:t}]}])}handleTextEnd(){this.currentMessageId=void 0,this.currentMessageContent=``}handleToolCallStart(e){this.currentToolCallId=e.toolCallId,this.currentToolCallName=e.toolName,this.currentToolCallArgs=``;let t=this.sessionManager.getMessages(),n=t[t.length-1],r={type:`tool-invocation`,toolInvocation:{status:z.PARTIAL_CALL,toolCallId:this.currentToolCallId,toolName:this.currentToolCallName,args:``}};n&&n.role===`assistant`?this.sessionManager.updateMessage({...n,parts:[...n.parts||[],r]}):this.sessionManager.addMessages([{id:Ze(),role:`assistant`,parts:[r]}])}handleToolCallArgsDelta(e){if(this.currentToolCallId!==e.toolCallId)return;this.currentToolCallArgs+=e.argsDelta;let t=this.sessionManager.getMessages(),n=t[t.length-1];if(!n||n.role!==`assistant`||!n.parts?.length)return;let r=[...n.parts];for(let t=r.length-1;t>=0;t--){let n=r[t];if(n.type===`tool-invocation`&&n.toolInvocation.toolCallId===e.toolCallId){let e;try{e=JSON.parse(this.currentToolCallArgs)}catch{}r[t]={...n,toolInvocation:{...n.toolInvocation,status:z.PARTIAL_CALL,args:this.currentToolCallArgs,parsedArgs:e}};break}}this.sessionManager.updateMessage({...n,parts:r})}handleToolCallArgs(e){this.currentToolCallId===e.toolCallId&&(this.currentToolCallArgs=e.args,this.handleToolCallArgsDelta({type:B.TOOL_CALL_ARGS_DELTA,toolCallId:e.toolCallId,argsDelta:``}))}handleToolCallEnd(){if(!(!this.currentToolCallId||!this.currentToolCallName)){try{let e={id:this.currentToolCallId,type:`function`,function:{name:this.currentToolCallName,arguments:this.currentToolCallArgs}},t=this.sessionManager.getMessages(),n=t[t.length-1];if(n&&n.role===`assistant`){let t=[...n.parts||[]];for(let n=t.length-1;n>=0;n--){let r=t[n];if(r.type===`tool-invocation`&&r.toolInvocation.toolCallId===this.currentToolCallId){t[n]={...r,toolInvocation:{...Ue(e),status:z.CALL}};break}}this.sessionManager.updateMessage({...n,parts:t})}else this.sessionManager.addMessages([{id:Ze(),role:`assistant`,parts:[{type:`tool-invocation`,toolInvocation:{...Ue(e),status:z.CALL}}]}])}catch(e){console.error(`Error parsing tool call args:`,e)}this.currentToolCallId=void 0,this.currentToolCallName=void 0,this.currentToolCallArgs=``}}},tt=e=>{let t=(0,I.useRef)(null),n=(0,I.useRef)(e);return n.current=e,t.current||=((...e)=>n.current(...e)),t.current},nt=e=>{let{agent:t,getToolDefs:n,getContexts:r,initialMessages:i,getToolExecutor:a}=e;return(0,I.useRef)(new $e({agent:t,getToolDefs:tt(n),getContexts:tt(r),getToolExecutor:tt(a)},{initialMessages:i})).current},rt=e=>({messages:Ve(e.messages$,e.getMessages()),isAgentResponding:Be(e.isAgentResponding$),threadId:Be(e.threadId$)});function it({agent:e,toolDefs:t,toolExecutors:n,contexts:r=[],initialMessages:i=[]}){let a=nt({agent:e,getToolDefs:()=>t,getContexts:()=>r,initialMessages:i,getToolExecutor:e=>n?.[e]}),{reset:o,abortAgentRun:s,runAgent:c,handleAddToolResult:l,handleAddMessages:u,handleSendMessage:d,setMessages:f,removeMessages:p}=a;return{sessionManager:a,...rt(a),sendMessage:d,addToolResult:l,addMessages:u,reset:o,abortAgentRun:s,setMessages:f,runAgent:c,removeMessages:p}}var at=(e={})=>{let{maxAttachments:t=5,validateFile:n,classifyAttachment:r,onAppendText:i}=e,[a,o]=(0,I.useState)(!1),[s,c]=(0,I.useState)(),[l,u]=(0,I.useState)([]),[d,f]=(0,I.useState)(!1),p=(0,I.useRef)(null),m=(0,I.useRef)([]),h=(0,I.useCallback)(e=>{let i=[];for(let t of e){if(n&&!n(t))continue;let e=r?r(t):t.type.startsWith(`image/`)?`image`:`file`;i.push({id:`${Date.now()}-${Math.random().toString(36).slice(2,9)}`,type:e,name:t.name,size:t.size,file:t})}i.length!==0&&u(e=>[...e,...i].slice(0,t))},[t,n,r]),g=(0,I.useCallback)(e=>{u(t=>t.filter(t=>t.id!==e))},[]),_=(0,I.useCallback)(()=>{u([])},[]),v=(0,I.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);p.current=t,m.current=[],t.ondataavailable=e=>{e.data.size>0&&m.current.push(e.data)},t.onstop=()=>{c(new Blob(m.current,{type:`audio/wav`})),e.getTracks().forEach(e=>e.stop())},t.start(),o(!0)}catch(e){console.error(`Error starting voice recording:`,e)}},[]),y=(0,I.useCallback)(()=>{p.current&&a&&(p.current.stop(),o(!1))},[a]),b=(0,I.useCallback)(e=>{i&&i(e),f(!1)},[i]),x=(0,I.useCallback)(()=>{u([]),c(void 0),f(!1),o(!1)},[]);return[{isVoiceRecording:a,audioBlob:s,attachments:l,showEmojiPicker:d},{startVoiceRecording:v,stopVoiceRecording:y,setAudioBlob:c,addAttachments:h,removeAttachment:g,clearAttachments:_,setShowEmojiPicker:f,insertEmoji:b,reset:x}]},ot=(e,t)=>{let n=Array(e.length+t.length);for(let t=0;t<e.length;t++)n[t]=e[t];for(let r=0;r<t.length;r++)n[e.length+r]=t[r];return n},st=(e,t)=>({classGroupId:e,validator:t}),ct=(e=new Map,t=null,n)=>({nextPart:e,validators:t,classGroupId:n}),lt=`-`,ut=[],dt=`arbitrary..`,ft=e=>{let t=ht(e),{conflictingClassGroups:n,conflictingClassGroupModifiers:r}=e;return{getClassGroupId:e=>{if(e.startsWith(`[`)&&e.endsWith(`]`))return mt(e);let n=e.split(lt);return pt(n,n[0]===``&&n.length>1?1:0,t)},getConflictingClassGroupIds:(e,t)=>{if(t){let t=r[e],i=n[e];return t?i?ot(i,t):t:i||ut}return n[e]||ut}}},pt=(e,t,n)=>{if(e.length-t===0)return n.classGroupId;let r=e[t],i=n.nextPart.get(r);if(i){let n=pt(e,t+1,i);if(n)return n}let a=n.validators;if(a===null)return;let o=t===0?e.join(lt):e.slice(t).join(lt),s=a.length;for(let e=0;e<s;e++){let t=a[e];if(t.validator(o))return t.classGroupId}},mt=e=>e.slice(1,-1).indexOf(`:`)===-1?void 0:(()=>{let t=e.slice(1,-1),n=t.indexOf(`:`),r=t.slice(0,n);return r?dt+r:void 0})(),ht=e=>{let{theme:t,classGroups:n}=e;return gt(n,t)},gt=(e,t)=>{let n=ct();for(let r in e){let i=e[r];_t(i,n,r,t)}return n},_t=(e,t,n,r)=>{let i=e.length;for(let a=0;a<i;a++){let i=e[a];vt(i,t,n,r)}},vt=(e,t,n,r)=>{if(typeof e==`string`){yt(e,t,n);return}if(typeof e==`function`){bt(e,t,n,r);return}xt(e,t,n,r)},yt=(e,t,n)=>{let r=e===``?t:St(t,e);r.classGroupId=n},bt=(e,t,n,r)=>{if(Ct(e)){_t(e(r),t,n,r);return}t.validators===null&&(t.validators=[]),t.validators.push(st(n,e))},xt=(e,t,n,r)=>{let i=Object.entries(e),a=i.length;for(let e=0;e<a;e++){let[a,o]=i[e];_t(o,St(t,a),n,r)}},St=(e,t)=>{let n=e,r=t.split(lt),i=r.length;for(let e=0;e<i;e++){let t=r[e],i=n.nextPart.get(t);i||(i=ct(),n.nextPart.set(t,i)),n=i}return n},Ct=e=>`isThemeGetter`in e&&e.isThemeGetter===!0,wt=e=>{if(e<1)return{get:()=>void 0,set:()=>{}};let t=0,n=Object.create(null),r=Object.create(null),i=(i,a)=>{n[i]=a,t++,t>e&&(t=0,r=n,n=Object.create(null))};return{get(e){let t=n[e];if(t!==void 0)return t;if((t=r[e])!==void 0)return i(e,t),t},set(e,t){e in n?n[e]=t:i(e,t)}}},Tt=`!`,Et=`:`,Dt=[],Ot=(e,t,n,r,i)=>({modifiers:e,hasImportantModifier:t,baseClassName:n,maybePostfixModifierPosition:r,isExternal:i}),kt=e=>{let{prefix:t,experimentalParseClassName:n}=e,r=e=>{let t=[],n=0,r=0,i=0,a,o=e.length;for(let s=0;s<o;s++){let o=e[s];if(n===0&&r===0){if(o===Et){t.push(e.slice(i,s)),i=s+1;continue}if(o===`/`){a=s;continue}}o===`[`?n++:o===`]`?n--:o===`(`?r++:o===`)`&&r--}let s=t.length===0?e:e.slice(i),c=s,l=!1;s.endsWith(Tt)?(c=s.slice(0,-1),l=!0):s.startsWith(Tt)&&(c=s.slice(1),l=!0);let u=a&&a>i?a-i:void 0;return Ot(t,l,c,u)};if(t){let e=t+Et,n=r;r=t=>t.startsWith(e)?n(t.slice(e.length)):Ot(Dt,!1,t,void 0,!0)}if(n){let e=r;r=t=>n({className:t,parseClassName:e})}return r},At=e=>{let t=new Map;return e.orderSensitiveModifiers.forEach((e,n)=>{t.set(e,1e6+n)}),e=>{let n=[],r=[];for(let i=0;i<e.length;i++){let a=e[i],o=a[0]===`[`,s=t.has(a);o||s?(r.length>0&&(r.sort(),n.push(...r),r=[]),n.push(a)):r.push(a)}return r.length>0&&(r.sort(),n.push(...r)),n}},jt=e=>({cache:wt(e.cacheSize),parseClassName:kt(e),sortModifiers:At(e),...ft(e)}),Mt=/\s+/,Nt=(e,t)=>{let{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:i,sortModifiers:a}=t,o=[],s=e.trim().split(Mt),c=``;for(let e=s.length-1;e>=0;--e){let t=s[e],{isExternal:l,modifiers:u,hasImportantModifier:d,baseClassName:f,maybePostfixModifierPosition:p}=n(t);if(l){c=t+(c.length>0?` `+c:c);continue}let m=!!p,h=r(m?f.substring(0,p):f);if(!h){if(!m){c=t+(c.length>0?` `+c:c);continue}if(h=r(f),!h){c=t+(c.length>0?` `+c:c);continue}m=!1}let g=u.length===0?``:u.length===1?u[0]:a(u).join(`:`),_=d?g+Tt:g,v=_+h;if(o.indexOf(v)>-1)continue;o.push(v);let y=i(h,m);for(let e=0;e<y.length;++e){let t=y[e];o.push(_+t)}c=t+(c.length>0?` `+c:c)}return c},Pt=(...e)=>{let t=0,n,r,i=``;for(;t<e.length;)(n=e[t++])&&(r=Ft(n))&&(i&&(i+=` `),i+=r);return i},Ft=e=>{if(typeof e==`string`)return e;let t,n=``;for(let r=0;r<e.length;r++)e[r]&&(t=Ft(e[r]))&&(n&&(n+=` `),n+=t);return n},It=(e,...t)=>{let n,r,i,a,o=o=>(n=jt(t.reduce((e,t)=>t(e),e())),r=n.cache.get,i=n.cache.set,a=s,s(o)),s=e=>{let t=r(e);if(t)return t;let a=Nt(e,n);return i(e,a),a};return a=o,(...e)=>a(Pt(...e))},Lt=[],H=e=>{let t=t=>t[e]||Lt;return t.isThemeGetter=!0,t},Rt=/^\[(?:(\w[\w-]*):)?(.+)\]$/i,zt=/^\((?:(\w[\w-]*):)?(.+)\)$/i,Bt=/^\d+\/\d+$/,Vt=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,Ht=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,Ut=/^(rgba?|hsla?|hwb|(ok)?(lab|lch)|color-mix)\(.+\)$/,Wt=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,Gt=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,U=e=>Bt.test(e),W=e=>!!e&&!Number.isNaN(Number(e)),G=e=>!!e&&Number.isInteger(Number(e)),Kt=e=>e.endsWith(`%`)&&W(e.slice(0,-1)),K=e=>Vt.test(e),qt=()=>!0,Jt=e=>Ht.test(e)&&!Ut.test(e),Yt=()=>!1,Xt=e=>Wt.test(e),Zt=e=>Gt.test(e),Qt=e=>!q(e)&&!Y(e),$t=e=>dn(e,hn,Yt),q=e=>Rt.test(e),J=e=>dn(e,gn,Jt),en=e=>dn(e,_n,W),tn=e=>dn(e,pn,Yt),nn=e=>dn(e,mn,Zt),rn=e=>dn(e,yn,Xt),Y=e=>zt.test(e),an=e=>fn(e,gn),on=e=>fn(e,vn),sn=e=>fn(e,pn),cn=e=>fn(e,hn),ln=e=>fn(e,mn),un=e=>fn(e,yn,!0),dn=(e,t,n)=>{let r=Rt.exec(e);return r?r[1]?t(r[1]):n(r[2]):!1},fn=(e,t,n=!1)=>{let r=zt.exec(e);return r?r[1]?t(r[1]):n:!1},pn=e=>e===`position`||e===`percentage`,mn=e=>e===`image`||e===`url`,hn=e=>e===`length`||e===`size`||e===`bg-size`,gn=e=>e===`length`,_n=e=>e===`number`,vn=e=>e===`family-name`,yn=e=>e===`shadow`,bn=It(()=>{let e=H(`color`),t=H(`font`),n=H(`text`),r=H(`font-weight`),i=H(`tracking`),a=H(`leading`),o=H(`breakpoint`),s=H(`container`),c=H(`spacing`),l=H(`radius`),u=H(`shadow`),d=H(`inset-shadow`),f=H(`text-shadow`),p=H(`drop-shadow`),m=H(`blur`),h=H(`perspective`),g=H(`aspect`),_=H(`ease`),v=H(`animate`),y=()=>[`auto`,`avoid`,`all`,`avoid-page`,`page`,`left`,`right`,`column`],b=()=>[`center`,`top`,`bottom`,`left`,`right`,`top-left`,`left-top`,`top-right`,`right-top`,`bottom-right`,`right-bottom`,`bottom-left`,`left-bottom`],x=()=>[...b(),Y,q],S=()=>[`auto`,`hidden`,`clip`,`visible`,`scroll`],ee=()=>[`auto`,`contain`,`none`],C=()=>[Y,q,c],w=()=>[U,`full`,`auto`,...C()],te=()=>[G,`none`,`subgrid`,Y,q],T=()=>[`auto`,{span:[`full`,G,Y,q]},G,Y,q],E=()=>[G,`auto`,Y,q],D=()=>[`auto`,`min`,`max`,`fr`,Y,q],O=()=>[`start`,`end`,`center`,`between`,`around`,`evenly`,`stretch`,`baseline`,`center-safe`,`end-safe`],k=()=>[`start`,`end`,`center`,`stretch`,`center-safe`,`end-safe`],A=()=>[`auto`,...C()],j=()=>[U,`auto`,`full`,`dvw`,`dvh`,`lvw`,`lvh`,`svw`,`svh`,`min`,`max`,`fit`,...C()],M=()=>[e,Y,q],ne=()=>[...b(),sn,tn,{position:[Y,q]}],re=()=>[`no-repeat`,{repeat:[``,`x`,`y`,`space`,`round`]}],ie=()=>[`auto`,`cover`,`contain`,cn,$t,{size:[Y,q]}],ae=()=>[Kt,an,J],N=()=>[``,`none`,`full`,l,Y,q],P=()=>[``,W,an,J],oe=()=>[`solid`,`dashed`,`dotted`,`double`],se=()=>[`normal`,`multiply`,`screen`,`overlay`,`darken`,`lighten`,`color-dodge`,`color-burn`,`hard-light`,`soft-light`,`difference`,`exclusion`,`hue`,`saturation`,`color`,`luminosity`],F=()=>[W,Kt,sn,tn],ce=()=>[``,`none`,m,Y,q],le=()=>[`none`,W,Y,q],ue=()=>[`none`,W,Y,q],de=()=>[W,Y,q],fe=()=>[U,`full`,...C()];return{cacheSize:500,theme:{animate:[`spin`,`ping`,`pulse`,`bounce`],aspect:[`video`],blur:[K],breakpoint:[K],color:[qt],container:[K],"drop-shadow":[K],ease:[`in`,`out`,`in-out`],font:[Qt],"font-weight":[`thin`,`extralight`,`light`,`normal`,`medium`,`semibold`,`bold`,`extrabold`,`black`],"inset-shadow":[K],leading:[`none`,`tight`,`snug`,`normal`,`relaxed`,`loose`],perspective:[`dramatic`,`near`,`normal`,`midrange`,`distant`,`none`],radius:[K],shadow:[K],spacing:[`px`,W],text:[K],"text-shadow":[K],tracking:[`tighter`,`tight`,`normal`,`wide`,`wider`,`widest`]},classGroups:{aspect:[{aspect:[`auto`,`square`,U,q,Y,g]}],container:[`container`],columns:[{columns:[W,q,Y,s]}],"break-after":[{"break-after":y()}],"break-before":[{"break-before":y()}],"break-inside":[{"break-inside":[`auto`,`avoid`,`avoid-page`,`avoid-column`]}],"box-decoration":[{"box-decoration":[`slice`,`clone`]}],box:[{box:[`border`,`content`]}],display:[`block`,`inline-block`,`inline`,`flex`,`inline-flex`,`table`,`inline-table`,`table-caption`,`table-cell`,`table-column`,`table-column-group`,`table-footer-group`,`table-header-group`,`table-row-group`,`table-row`,`flow-root`,`grid`,`inline-grid`,`contents`,`list-item`,`hidden`],sr:[`sr-only`,`not-sr-only`],float:[{float:[`right`,`left`,`none`,`start`,`end`]}],clear:[{clear:[`left`,`right`,`both`,`none`,`start`,`end`]}],isolation:[`isolate`,`isolation-auto`],"object-fit":[{object:[`contain`,`cover`,`fill`,`none`,`scale-down`]}],"object-position":[{object:x()}],overflow:[{overflow:S()}],"overflow-x":[{"overflow-x":S()}],"overflow-y":[{"overflow-y":S()}],overscroll:[{overscroll:ee()}],"overscroll-x":[{"overscroll-x":ee()}],"overscroll-y":[{"overscroll-y":ee()}],position:[`static`,`fixed`,`absolute`,`relative`,`sticky`],inset:[{inset:w()}],"inset-x":[{"inset-x":w()}],"inset-y":[{"inset-y":w()}],start:[{start:w()}],end:[{end:w()}],top:[{top:w()}],right:[{right:w()}],bottom:[{bottom:w()}],left:[{left:w()}],visibility:[`visible`,`invisible`,`collapse`],z:[{z:[G,`auto`,Y,q]}],basis:[{basis:[U,`full`,`auto`,s,...C()]}],"flex-direction":[{flex:[`row`,`row-reverse`,`col`,`col-reverse`]}],"flex-wrap":[{flex:[`nowrap`,`wrap`,`wrap-reverse`]}],flex:[{flex:[W,U,`auto`,`initial`,`none`,q]}],grow:[{grow:[``,W,Y,q]}],shrink:[{shrink:[``,W,Y,q]}],order:[{order:[G,`first`,`last`,`none`,Y,q]}],"grid-cols":[{"grid-cols":te()}],"col-start-end":[{col:T()}],"col-start":[{"col-start":E()}],"col-end":[{"col-end":E()}],"grid-rows":[{"grid-rows":te()}],"row-start-end":[{row:T()}],"row-start":[{"row-start":E()}],"row-end":[{"row-end":E()}],"grid-flow":[{"grid-flow":[`row`,`col`,`dense`,`row-dense`,`col-dense`]}],"auto-cols":[{"auto-cols":D()}],"auto-rows":[{"auto-rows":D()}],gap:[{gap:C()}],"gap-x":[{"gap-x":C()}],"gap-y":[{"gap-y":C()}],"justify-content":[{justify:[...O(),`normal`]}],"justify-items":[{"justify-items":[...k(),`normal`]}],"justify-self":[{"justify-self":[`auto`,...k()]}],"align-content":[{content:[`normal`,...O()]}],"align-items":[{items:[...k(),{baseline:[``,`last`]}]}],"align-self":[{self:[`auto`,...k(),{baseline:[``,`last`]}]}],"place-content":[{"place-content":O()}],"place-items":[{"place-items":[...k(),`baseline`]}],"place-self":[{"place-self":[`auto`,...k()]}],p:[{p:C()}],px:[{px:C()}],py:[{py:C()}],ps:[{ps:C()}],pe:[{pe:C()}],pt:[{pt:C()}],pr:[{pr:C()}],pb:[{pb:C()}],pl:[{pl:C()}],m:[{m:A()}],mx:[{mx:A()}],my:[{my:A()}],ms:[{ms:A()}],me:[{me:A()}],mt:[{mt:A()}],mr:[{mr:A()}],mb:[{mb:A()}],ml:[{ml:A()}],"space-x":[{"space-x":C()}],"space-x-reverse":[`space-x-reverse`],"space-y":[{"space-y":C()}],"space-y-reverse":[`space-y-reverse`],size:[{size:j()}],w:[{w:[s,`screen`,...j()]}],"min-w":[{"min-w":[s,`screen`,`none`,...j()]}],"max-w":[{"max-w":[s,`screen`,`none`,`prose`,{screen:[o]},...j()]}],h:[{h:[`screen`,`lh`,...j()]}],"min-h":[{"min-h":[`screen`,`lh`,`none`,...j()]}],"max-h":[{"max-h":[`screen`,`lh`,...j()]}],"font-size":[{text:[`base`,n,an,J]}],"font-smoothing":[`antialiased`,`subpixel-antialiased`],"font-style":[`italic`,`not-italic`],"font-weight":[{font:[r,Y,en]}],"font-stretch":[{"font-stretch":[`ultra-condensed`,`extra-condensed`,`condensed`,`semi-condensed`,`normal`,`semi-expanded`,`expanded`,`extra-expanded`,`ultra-expanded`,Kt,q]}],"font-family":[{font:[on,q,t]}],"fvn-normal":[`normal-nums`],"fvn-ordinal":[`ordinal`],"fvn-slashed-zero":[`slashed-zero`],"fvn-figure":[`lining-nums`,`oldstyle-nums`],"fvn-spacing":[`proportional-nums`,`tabular-nums`],"fvn-fraction":[`diagonal-fractions`,`stacked-fractions`],tracking:[{tracking:[i,Y,q]}],"line-clamp":[{"line-clamp":[W,`none`,Y,en]}],leading:[{leading:[a,...C()]}],"list-image":[{"list-image":[`none`,Y,q]}],"list-style-position":[{list:[`inside`,`outside`]}],"list-style-type":[{list:[`disc`,`decimal`,`none`,Y,q]}],"text-alignment":[{text:[`left`,`center`,`right`,`justify`,`start`,`end`]}],"placeholder-color":[{placeholder:M()}],"text-color":[{text:M()}],"text-decoration":[`underline`,`overline`,`line-through`,`no-underline`],"text-decoration-style":[{decoration:[...oe(),`wavy`]}],"text-decoration-thickness":[{decoration:[W,`from-font`,`auto`,Y,J]}],"text-decoration-color":[{decoration:M()}],"underline-offset":[{"underline-offset":[W,`auto`,Y,q]}],"text-transform":[`uppercase`,`lowercase`,`capitalize`,`normal-case`],"text-overflow":[`truncate`,`text-ellipsis`,`text-clip`],"text-wrap":[{text:[`wrap`,`nowrap`,`balance`,`pretty`]}],indent:[{indent:C()}],"vertical-align":[{align:[`baseline`,`top`,`middle`,`bottom`,`text-top`,`text-bottom`,`sub`,`super`,Y,q]}],whitespace:[{whitespace:[`normal`,`nowrap`,`pre`,`pre-line`,`pre-wrap`,`break-spaces`]}],break:[{break:[`normal`,`words`,`all`,`keep`]}],wrap:[{wrap:[`break-word`,`anywhere`,`normal`]}],hyphens:[{hyphens:[`none`,`manual`,`auto`]}],content:[{content:[`none`,Y,q]}],"bg-attachment":[{bg:[`fixed`,`local`,`scroll`]}],"bg-clip":[{"bg-clip":[`border`,`padding`,`content`,`text`]}],"bg-origin":[{"bg-origin":[`border`,`padding`,`content`]}],"bg-position":[{bg:ne()}],"bg-repeat":[{bg:re()}],"bg-size":[{bg:ie()}],"bg-image":[{bg:[`none`,{linear:[{to:[`t`,`tr`,`r`,`br`,`b`,`bl`,`l`,`tl`]},G,Y,q],radial:[``,Y,q],conic:[G,Y,q]},ln,nn]}],"bg-color":[{bg:M()}],"gradient-from-pos":[{from:ae()}],"gradient-via-pos":[{via:ae()}],"gradient-to-pos":[{to:ae()}],"gradient-from":[{from:M()}],"gradient-via":[{via:M()}],"gradient-to":[{to:M()}],rounded:[{rounded:N()}],"rounded-s":[{"rounded-s":N()}],"rounded-e":[{"rounded-e":N()}],"rounded-t":[{"rounded-t":N()}],"rounded-r":[{"rounded-r":N()}],"rounded-b":[{"rounded-b":N()}],"rounded-l":[{"rounded-l":N()}],"rounded-ss":[{"rounded-ss":N()}],"rounded-se":[{"rounded-se":N()}],"rounded-ee":[{"rounded-ee":N()}],"rounded-es":[{"rounded-es":N()}],"rounded-tl":[{"rounded-tl":N()}],"rounded-tr":[{"rounded-tr":N()}],"rounded-br":[{"rounded-br":N()}],"rounded-bl":[{"rounded-bl":N()}],"border-w":[{border:P()}],"border-w-x":[{"border-x":P()}],"border-w-y":[{"border-y":P()}],"border-w-s":[{"border-s":P()}],"border-w-e":[{"border-e":P()}],"border-w-t":[{"border-t":P()}],"border-w-r":[{"border-r":P()}],"border-w-b":[{"border-b":P()}],"border-w-l":[{"border-l":P()}],"divide-x":[{"divide-x":P()}],"divide-x-reverse":[`divide-x-reverse`],"divide-y":[{"divide-y":P()}],"divide-y-reverse":[`divide-y-reverse`],"border-style":[{border:[...oe(),`hidden`,`none`]}],"divide-style":[{divide:[...oe(),`hidden`,`none`]}],"border-color":[{border:M()}],"border-color-x":[{"border-x":M()}],"border-color-y":[{"border-y":M()}],"border-color-s":[{"border-s":M()}],"border-color-e":[{"border-e":M()}],"border-color-t":[{"border-t":M()}],"border-color-r":[{"border-r":M()}],"border-color-b":[{"border-b":M()}],"border-color-l":[{"border-l":M()}],"divide-color":[{divide:M()}],"outline-style":[{outline:[...oe(),`none`,`hidden`]}],"outline-offset":[{"outline-offset":[W,Y,q]}],"outline-w":[{outline:[``,W,an,J]}],"outline-color":[{outline:M()}],shadow:[{shadow:[``,`none`,u,un,rn]}],"shadow-color":[{shadow:M()}],"inset-shadow":[{"inset-shadow":[`none`,d,un,rn]}],"inset-shadow-color":[{"inset-shadow":M()}],"ring-w":[{ring:P()}],"ring-w-inset":[`ring-inset`],"ring-color":[{ring:M()}],"ring-offset-w":[{"ring-offset":[W,J]}],"ring-offset-color":[{"ring-offset":M()}],"inset-ring-w":[{"inset-ring":P()}],"inset-ring-color":[{"inset-ring":M()}],"text-shadow":[{"text-shadow":[`none`,f,un,rn]}],"text-shadow-color":[{"text-shadow":M()}],opacity:[{opacity:[W,Y,q]}],"mix-blend":[{"mix-blend":[...se(),`plus-darker`,`plus-lighter`]}],"bg-blend":[{"bg-blend":se()}],"mask-clip":[{"mask-clip":[`border`,`padding`,`content`,`fill`,`stroke`,`view`]},`mask-no-clip`],"mask-composite":[{mask:[`add`,`subtract`,`intersect`,`exclude`]}],"mask-image-linear-pos":[{"mask-linear":[W]}],"mask-image-linear-from-pos":[{"mask-linear-from":F()}],"mask-image-linear-to-pos":[{"mask-linear-to":F()}],"mask-image-linear-from-color":[{"mask-linear-from":M()}],"mask-image-linear-to-color":[{"mask-linear-to":M()}],"mask-image-t-from-pos":[{"mask-t-from":F()}],"mask-image-t-to-pos":[{"mask-t-to":F()}],"mask-image-t-from-color":[{"mask-t-from":M()}],"mask-image-t-to-color":[{"mask-t-to":M()}],"mask-image-r-from-pos":[{"mask-r-from":F()}],"mask-image-r-to-pos":[{"mask-r-to":F()}],"mask-image-r-from-color":[{"mask-r-from":M()}],"mask-image-r-to-color":[{"mask-r-to":M()}],"mask-image-b-from-pos":[{"mask-b-from":F()}],"mask-image-b-to-pos":[{"mask-b-to":F()}],"mask-image-b-from-color":[{"mask-b-from":M()}],"mask-image-b-to-color":[{"mask-b-to":M()}],"mask-image-l-from-pos":[{"mask-l-from":F()}],"mask-image-l-to-pos":[{"mask-l-to":F()}],"mask-image-l-from-color":[{"mask-l-from":M()}],"mask-image-l-to-color":[{"mask-l-to":M()}],"mask-image-x-from-pos":[{"mask-x-from":F()}],"mask-image-x-to-pos":[{"mask-x-to":F()}],"mask-image-x-from-color":[{"mask-x-from":M()}],"mask-image-x-to-color":[{"mask-x-to":M()}],"mask-image-y-from-pos":[{"mask-y-from":F()}],"mask-image-y-to-pos":[{"mask-y-to":F()}],"mask-image-y-from-color":[{"mask-y-from":M()}],"mask-image-y-to-color":[{"mask-y-to":M()}],"mask-image-radial":[{"mask-radial":[Y,q]}],"mask-image-radial-from-pos":[{"mask-radial-from":F()}],"mask-image-radial-to-pos":[{"mask-radial-to":F()}],"mask-image-radial-from-color":[{"mask-radial-from":M()}],"mask-image-radial-to-color":[{"mask-radial-to":M()}],"mask-image-radial-shape":[{"mask-radial":[`circle`,`ellipse`]}],"mask-image-radial-size":[{"mask-radial":[{closest:[`side`,`corner`],farthest:[`side`,`corner`]}]}],"mask-image-radial-pos":[{"mask-radial-at":b()}],"mask-image-conic-pos":[{"mask-conic":[W]}],"mask-image-conic-from-pos":[{"mask-conic-from":F()}],"mask-image-conic-to-pos":[{"mask-conic-to":F()}],"mask-image-conic-from-color":[{"mask-conic-from":M()}],"mask-image-conic-to-color":[{"mask-conic-to":M()}],"mask-mode":[{mask:[`alpha`,`luminance`,`match`]}],"mask-origin":[{"mask-origin":[`border`,`padding`,`content`,`fill`,`stroke`,`view`]}],"mask-position":[{mask:ne()}],"mask-repeat":[{mask:re()}],"mask-size":[{mask:ie()}],"mask-type":[{"mask-type":[`alpha`,`luminance`]}],"mask-image":[{mask:[`none`,Y,q]}],filter:[{filter:[``,`none`,Y,q]}],blur:[{blur:ce()}],brightness:[{brightness:[W,Y,q]}],contrast:[{contrast:[W,Y,q]}],"drop-shadow":[{"drop-shadow":[``,`none`,p,un,rn]}],"drop-shadow-color":[{"drop-shadow":M()}],grayscale:[{grayscale:[``,W,Y,q]}],"hue-rotate":[{"hue-rotate":[W,Y,q]}],invert:[{invert:[``,W,Y,q]}],saturate:[{saturate:[W,Y,q]}],sepia:[{sepia:[``,W,Y,q]}],"backdrop-filter":[{"backdrop-filter":[``,`none`,Y,q]}],"backdrop-blur":[{"backdrop-blur":ce()}],"backdrop-brightness":[{"backdrop-brightness":[W,Y,q]}],"backdrop-contrast":[{"backdrop-contrast":[W,Y,q]}],"backdrop-grayscale":[{"backdrop-grayscale":[``,W,Y,q]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[W,Y,q]}],"backdrop-invert":[{"backdrop-invert":[``,W,Y,q]}],"backdrop-opacity":[{"backdrop-opacity":[W,Y,q]}],"backdrop-saturate":[{"backdrop-saturate":[W,Y,q]}],"backdrop-sepia":[{"backdrop-sepia":[``,W,Y,q]}],"border-collapse":[{border:[`collapse`,`separate`]}],"border-spacing":[{"border-spacing":C()}],"border-spacing-x":[{"border-spacing-x":C()}],"border-spacing-y":[{"border-spacing-y":C()}],"table-layout":[{table:[`auto`,`fixed`]}],caption:[{caption:[`top`,`bottom`]}],transition:[{transition:[``,`all`,`colors`,`opacity`,`shadow`,`transform`,`none`,Y,q]}],"transition-behavior":[{transition:[`normal`,`discrete`]}],duration:[{duration:[W,`initial`,Y,q]}],ease:[{ease:[`linear`,`initial`,_,Y,q]}],delay:[{delay:[W,Y,q]}],animate:[{animate:[`none`,v,Y,q]}],backface:[{backface:[`hidden`,`visible`]}],perspective:[{perspective:[h,Y,q]}],"perspective-origin":[{"perspective-origin":x()}],rotate:[{rotate:le()}],"rotate-x":[{"rotate-x":le()}],"rotate-y":[{"rotate-y":le()}],"rotate-z":[{"rotate-z":le()}],scale:[{scale:ue()}],"scale-x":[{"scale-x":ue()}],"scale-y":[{"scale-y":ue()}],"scale-z":[{"scale-z":ue()}],"scale-3d":[`scale-3d`],skew:[{skew:de()}],"skew-x":[{"skew-x":de()}],"skew-y":[{"skew-y":de()}],transform:[{transform:[Y,q,``,`none`,`gpu`,`cpu`]}],"transform-origin":[{origin:x()}],"transform-style":[{transform:[`3d`,`flat`]}],translate:[{translate:fe()}],"translate-x":[{"translate-x":fe()}],"translate-y":[{"translate-y":fe()}],"translate-z":[{"translate-z":fe()}],"translate-none":[`translate-none`],accent:[{accent:M()}],appearance:[{appearance:[`none`,`auto`]}],"caret-color":[{caret:M()}],"color-scheme":[{scheme:[`normal`,`dark`,`light`,`light-dark`,`only-dark`,`only-light`]}],cursor:[{cursor:[`auto`,`default`,`pointer`,`wait`,`text`,`move`,`help`,`not-allowed`,`none`,`context-menu`,`progress`,`cell`,`crosshair`,`vertical-text`,`alias`,`copy`,`no-drop`,`grab`,`grabbing`,`all-scroll`,`col-resize`,`row-resize`,`n-resize`,`e-resize`,`s-resize`,`w-resize`,`ne-resize`,`nw-resize`,`se-resize`,`sw-resize`,`ew-resize`,`ns-resize`,`nesw-resize`,`nwse-resize`,`zoom-in`,`zoom-out`,Y,q]}],"field-sizing":[{"field-sizing":[`fixed`,`content`]}],"pointer-events":[{"pointer-events":[`auto`,`none`]}],resize:[{resize:[`none`,``,`y`,`x`]}],"scroll-behavior":[{scroll:[`auto`,`smooth`]}],"scroll-m":[{"scroll-m":C()}],"scroll-mx":[{"scroll-mx":C()}],"scroll-my":[{"scroll-my":C()}],"scroll-ms":[{"scroll-ms":C()}],"scroll-me":[{"scroll-me":C()}],"scroll-mt":[{"scroll-mt":C()}],"scroll-mr":[{"scroll-mr":C()}],"scroll-mb":[{"scroll-mb":C()}],"scroll-ml":[{"scroll-ml":C()}],"scroll-p":[{"scroll-p":C()}],"scroll-px":[{"scroll-px":C()}],"scroll-py":[{"scroll-py":C()}],"scroll-ps":[{"scroll-ps":C()}],"scroll-pe":[{"scroll-pe":C()}],"scroll-pt":[{"scroll-pt":C()}],"scroll-pr":[{"scroll-pr":C()}],"scroll-pb":[{"scroll-pb":C()}],"scroll-pl":[{"scroll-pl":C()}],"snap-align":[{snap:[`start`,`end`,`center`,`align-none`]}],"snap-stop":[{snap:[`normal`,`always`]}],"snap-type":[{snap:[`none`,`x`,`y`,`both`]}],"snap-strictness":[{snap:[`mandatory`,`proximity`]}],touch:[{touch:[`auto`,`none`,`manipulation`]}],"touch-x":[{"touch-pan":[`x`,`left`,`right`]}],"touch-y":[{"touch-pan":[`y`,`up`,`down`]}],"touch-pz":[`touch-pinch-zoom`],select:[{select:[`none`,`text`,`all`,`auto`]}],"will-change":[{"will-change":[`auto`,`scroll`,`contents`,`transform`,Y,q]}],fill:[{fill:[`none`,...M()]}],"stroke-w":[{stroke:[W,an,J,en]}],stroke:[{stroke:[`none`,...M()]}],"forced-color-adjust":[{"forced-color-adjust":[`auto`,`none`]}]},conflictingClassGroups:{overflow:[`overflow-x`,`overflow-y`],overscroll:[`overscroll-x`,`overscroll-y`],inset:[`inset-x`,`inset-y`,`start`,`end`,`top`,`right`,`bottom`,`left`],"inset-x":[`right`,`left`],"inset-y":[`top`,`bottom`],flex:[`basis`,`grow`,`shrink`],gap:[`gap-x`,`gap-y`],p:[`px`,`py`,`ps`,`pe`,`pt`,`pr`,`pb`,`pl`],px:[`pr`,`pl`],py:[`pt`,`pb`],m:[`mx`,`my`,`ms`,`me`,`mt`,`mr`,`mb`,`ml`],mx:[`mr`,`ml`],my:[`mt`,`mb`],size:[`w`,`h`],"font-size":[`leading`],"fvn-normal":[`fvn-ordinal`,`fvn-slashed-zero`,`fvn-figure`,`fvn-spacing`,`fvn-fraction`],"fvn-ordinal":[`fvn-normal`],"fvn-slashed-zero":[`fvn-normal`],"fvn-figure":[`fvn-normal`],"fvn-spacing":[`fvn-normal`],"fvn-fraction":[`fvn-normal`],"line-clamp":[`display`,`overflow`],rounded:[`rounded-s`,`rounded-e`,`rounded-t`,`rounded-r`,`rounded-b`,`rounded-l`,`rounded-ss`,`rounded-se`,`rounded-ee`,`rounded-es`,`rounded-tl`,`rounded-tr`,`rounded-br`,`rounded-bl`],"rounded-s":[`rounded-ss`,`rounded-es`],"rounded-e":[`rounded-se`,`rounded-ee`],"rounded-t":[`rounded-tl`,`rounded-tr`],"rounded-r":[`rounded-tr`,`rounded-br`],"rounded-b":[`rounded-br`,`rounded-bl`],"rounded-l":[`rounded-tl`,`rounded-bl`],"border-spacing":[`border-spacing-x`,`border-spacing-y`],"border-w":[`border-w-x`,`border-w-y`,`border-w-s`,`border-w-e`,`border-w-t`,`border-w-r`,`border-w-b`,`border-w-l`],"border-w-x":[`border-w-r`,`border-w-l`],"border-w-y":[`border-w-t`,`border-w-b`],"border-color":[`border-color-x`,`border-color-y`,`border-color-s`,`border-color-e`,`border-color-t`,`border-color-r`,`border-color-b`,`border-color-l`],"border-color-x":[`border-color-r`,`border-color-l`],"border-color-y":[`border-color-t`,`border-color-b`],translate:[`translate-x`,`translate-y`,`translate-none`],"translate-none":[`translate`,`translate-x`,`translate-y`,`translate-z`],"scroll-m":[`scroll-mx`,`scroll-my`,`scroll-ms`,`scroll-me`,`scroll-mt`,`scroll-mr`,`scroll-mb`,`scroll-ml`],"scroll-mx":[`scroll-mr`,`scroll-ml`],"scroll-my":[`scroll-mt`,`scroll-mb`],"scroll-p":[`scroll-px`,`scroll-py`,`scroll-ps`,`scroll-pe`,`scroll-pt`,`scroll-pr`,`scroll-pb`,`scroll-pl`],"scroll-px":[`scroll-pr`,`scroll-pl`],"scroll-py":[`scroll-pt`,`scroll-pb`],touch:[`touch-x`,`touch-y`,`touch-pz`],"touch-x":[`touch`],"touch-y":[`touch`],"touch-pz":[`touch`]},conflictingClassGroupModifiers:{"font-size":[`leading`]},orderSensitiveModifiers:[`*`,`**`,`after`,`backdrop`,`before`,`details-content`,`file`,`first-letter`,`first-line`,`marker`,`placeholder`,`selection`]}});function X(...e){return bn(o(e))}var Z=e(t(),1),xn=ee(`inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive`,{variants:{variant:{default:`bg-primary text-primary-foreground shadow-xs hover:bg-primary/90`,destructive:`bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60`,outline:`border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50`,secondary:`bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80`,ghost:`hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50`,link:`text-primary underline-offset-4 hover:underline`},size:{default:`h-9 px-4 py-2 has-[>svg]:px-3`,sm:`h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5`,lg:`h-10 rounded-md px-6 has-[>svg]:px-4`,icon:`size-9`}},defaultVariants:{variant:`default`,size:`default`}});function Q({className:e,variant:t,size:n,asChild:r=!1,...i}){return(0,Z.jsx)(r?c:`button`,{"data-slot":`button`,className:X(xn({variant:t,size:n,className:e})),...i})}var Sn=e=>e.replace(/([a-z0-9])([A-Z])/g,`$1-$2`).toLowerCase(),Cn=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,n)=>n?n.toUpperCase():t.toLowerCase()),wn=e=>{let t=Cn(e);return t.charAt(0).toUpperCase()+t.slice(1)},Tn=(...e)=>e.filter((e,t,n)=>!!e&&e.trim()!==``&&n.indexOf(e)===t).join(` `).trim(),En=e=>{for(let t in e)if(t.startsWith(`aria-`)||t===`role`||t===`title`)return!0},Dn={xmlns:`http://www.w3.org/2000/svg`,width:24,height:24,viewBox:`0 0 24 24`,fill:`none`,stroke:`currentColor`,strokeWidth:2,strokeLinecap:`round`,strokeLinejoin:`round`},On=(0,I.forwardRef)(({color:e=`currentColor`,size:t=24,strokeWidth:n=2,absoluteStrokeWidth:r,className:i=``,children:a,iconNode:o,...s},c)=>(0,I.createElement)(`svg`,{ref:c,...Dn,width:t,height:t,stroke:e,strokeWidth:r?Number(n)*24/Number(t):n,className:Tn(`lucide`,i),...!a&&!En(s)&&{"aria-hidden":`true`},...s},[...o.map(([e,t])=>(0,I.createElement)(e,t)),...Array.isArray(a)?a:[a]])),$=(e,t)=>{let n=(0,I.forwardRef)(({className:n,...r},i)=>(0,I.createElement)(On,{ref:i,iconNode:t,className:Tn(`lucide-${Sn(wn(e))}`,`lucide-${e}`,n),...r}));return n.displayName=wn(e),n},kn=$(`arrow-up-down`,[[`path`,{d:`m21 16-4 4-4-4`,key:`f6ql7i`}],[`path`,{d:`M17 20V4`,key:`1ejh1v`}],[`path`,{d:`m3 8 4-4 4 4`,key:`11wl7u`}],[`path`,{d:`M7 4v16`,key:`1glfcx`}]]),An=$(`bot`,[[`path`,{d:`M12 8V4H8`,key:`hb8ula`}],[`rect`,{width:`16`,height:`12`,x:`4`,y:`8`,rx:`2`,key:`enze0r`}],[`path`,{d:`M2 14h2`,key:`vft8re`}],[`path`,{d:`M20 14h2`,key:`4cs60a`}],[`path`,{d:`M15 13v2`,key:`1xurst`}],[`path`,{d:`M9 13v2`,key:`rq6x2g`}]]),jn=$(`copy`,[[`rect`,{width:`14`,height:`14`,x:`8`,y:`8`,rx:`2`,ry:`2`,key:`17jyea`}],[`path`,{d:`M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2`,key:`zix9uf`}]]),Mn=$(`loader-circle`,[[`path`,{d:`M21 12a9 9 0 1 1-6.219-8.56`,key:`13zald`}]]),Nn=$(`maximize-2`,[[`path`,{d:`M15 3h6v6`,key:`1q9fwt`}],[`path`,{d:`m21 3-7 7`,key:`1l2asr`}],[`path`,{d:`m3 21 7-7`,key:`tjx5ai`}],[`path`,{d:`M9 21H3v-6`,key:`wtvkvv`}]]),Pn=$(`message-square`,[[`path`,{d:`M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z`,key:`1lielz`}]]),Fn=$(`minimize-2`,[[`path`,{d:`m14 10 7-7`,key:`oa77jy`}],[`path`,{d:`M20 10h-6V4`,key:`mjg0md`}],[`path`,{d:`m3 21 7-7`,key:`tjx5ai`}],[`path`,{d:`M4 14h6v6`,key:`rmj7iw`}]]),In=$(`rotate-ccw`,[[`path`,{d:`M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8`,key:`1357e3`}],[`path`,{d:`M3 3v5h5`,key:`1xhq8a`}]]),Ln=$(`send`,[[`path`,{d:`M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z`,key:`1ffxy3`}],[`path`,{d:`m21.854 2.147-10.94 10.939`,key:`12cjpa`}]]),Rn=$(`share-2`,[[`circle`,{cx:`18`,cy:`5`,r:`3`,key:`gq8acd`}],[`circle`,{cx:`6`,cy:`12`,r:`3`,key:`w7nqdw`}],[`circle`,{cx:`18`,cy:`19`,r:`3`,key:`1xt0gg`}],[`line`,{x1:`8.59`,x2:`15.42`,y1:`13.51`,y2:`17.49`,key:`47mynk`}],[`line`,{x1:`15.41`,x2:`8.59`,y1:`6.51`,y2:`10.49`,key:`1n3mei`}]]),zn=$(`square`,[[`rect`,{width:`18`,height:`18`,x:`3`,y:`3`,rx:`2`,key:`afitv7`}]]),Bn=$(`thumbs-up`,[[`path`,{d:`M7 10v12`,key:`1qc93n`}],[`path`,{d:`M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2a3.13 3.13 0 0 1 3 3.88Z`,key:`emmmcr`}]]),Vn=$(`thumbs-down`,[[`path`,{d:`M17 14V2`,key:`8ymqnk`}],[`path`,{d:`M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22a3.13 3.13 0 0 1-3-3.88Z`,key:`m61m77`}]]),Hn=$(`trash-2`,[[`path`,{d:`M3 6h18`,key:`d0wm0j`}],[`path`,{d:`M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6`,key:`4alrt4`}],[`path`,{d:`M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2`,key:`v07s0e`}],[`line`,{x1:`10`,x2:`10`,y1:`11`,y2:`17`,key:`1uufr5`}],[`line`,{x1:`14`,x2:`14`,y1:`11`,y2:`17`,key:`xtxkd`}]]),Un=$(`user`,[[`path`,{d:`M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2`,key:`975kel`}],[`circle`,{cx:`12`,cy:`7`,r:`4`,key:`17ys0d`}]]),Wn=$(`x`,[[`path`,{d:`M18 6 6 18`,key:`1bl5f8`}],[`path`,{d:`m6 6 12 12`,key:`d8bk6v`}]]),Gn=({input:e,onInputChange:t,onSend:n,isAgentResponding:r,onAbort:i,placeholder:a=`Type a message...`,isProcessing:o=!1,processingMessage:s=`Processing...`,variant:c=`default`,size:l=`md`,inputExtensions:u=[],insideLeftSlot:d,insideRightSlot:f,headerLeftSlot:p,headerRightSlot:m,footerLeftSlot:h,footerRightSlot:g})=>{let _=I.useRef(null),v=I.useRef(!1),y=I.useCallback(()=>{let e=_.current;if(!e)return;e.style.height=`auto`;let t=l===`sm`?120:l===`lg`?300:200,n=window.getComputedStyle(e),r=parseInt(n.lineHeight)||24,i=parseInt(n.paddingTop)||8,a=parseInt(n.paddingBottom)||8,o=r+i+a,s=e.scrollHeight,c=Math.max(o,Math.min(s,t));e.style.height=`${c}px`,e.style.overflowY=s>t?`auto`:`hidden`},[l]);I.useLayoutEffect(()=>{y()},[e,y]);let b=e=>{t(e.target.value)},x=t=>{let a=t.key===`Enter`,o=(t.metaKey||t.ctrlKey)&&a;(a&&!t.shiftKey&&!t.altKey&&!t.metaKey&&!t.ctrlKey||o)&&!v.current&&(t.preventDefault(),!r&&e.trim()&&n()),t.key===`Escape`&&r&&i&&(t.preventDefault(),i())},S=()=>{v.current=!0},ee=()=>{v.current=!1},C=e.trim().length>0&&!r&&!o;return(0,Z.jsx)(`div`,{className:`w-full space-y-2`,children:(0,Z.jsxs)(`div`,{className:X(`relative w-full rounded-xl border transition-all duration-200`,`max-h-[60vh] overflow-hidden flex flex-col`,(()=>{switch(c){case`minimal`:return`border-0 bg-transparent shadow-none focus-within:ring-0`;case`glass`:return`bg-background/80 backdrop-blur-md border-border/70 shadow-lg`;default:return`bg-background/95 backdrop-blur-sm border-border/80 shadow-sm`}})(),(()=>{switch(l){case`sm`:return`px-3 py-2 text-sm`;case`lg`:return`px-4 py-3 text-base`;default:return`px-3 py-2.5 text-sm`}})()),children:[(p||m)&&(0,Z.jsx)(`div`,{className:`px-3 pt-3 pb-2`,children:(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 gap-y-1 flex-wrap`,children:[(0,Z.jsx)(`div`,{className:`flex items-center gap-2`,children:p}),(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 ml-auto`,children:[m,o&&(0,Z.jsxs)(`div`,{className:`flex items-center gap-1 text-xs text-muted-foreground`,children:[(0,Z.jsx)(Mn,{className:`h-3 w-3 animate-spin`}),s]})]})]})}),(0,Z.jsxs)(`div`,{className:`relative pt-3 flex-1 min-h-0`,children:[d&&(0,Z.jsx)(`div`,{className:`absolute left-3 top-1/2 -translate-y-1/2 z-10`,children:d}),(0,Z.jsx)(`textarea`,{ref:_,value:e,onChange:b,onKeyDown:x,onCompositionStart:S,onCompositionEnd:ee,placeholder:a,rows:1,"aria-label":`Message input`,"aria-multiline":`true`,"aria-busy":r,className:X(`w-full resize-none bg-transparent text-foreground`,`placeholder:text-muted-foreground outline-none`,`disabled:cursor-not-allowed disabled:opacity-50`,d?`pl-10`:`pl-3`,`py-2`),style:{minHeight:`40px`,height:`40px`}})]}),(0,Z.jsxs)(`div`,{className:`flex items-center justify-between py-2 text-xs text-muted-foreground flex-shrink-0`,children:[(0,Z.jsx)(`div`,{className:`flex items-center gap-2 flex-nowrap whitespace-nowrap overflow-x-auto`,children:h}),(0,Z.jsxs)(`div`,{className:`flex items-center gap-1 flex-nowrap whitespace-nowrap overflow-x-auto`,children:[u.map(n=>{let a={draft:{text:e,meta:{}},setDraft:n=>{if(typeof n==`function`){let r=n({text:e,meta:{}});r.text!==void 0&&t(r.text)}else n.text!==void 0&&t(n.text)},isAgentResponding:r,requestAbort:i};return(0,Z.jsx)(I.Fragment,{children:n.render(a)},n.id)}),r?(0,Z.jsx)(Q,{variant:`ghost`,size:`icon`,onClick:e=>{e.preventDefault(),e.stopPropagation(),i?.()},title:`Stop (Esc)`,className:`h-8 w-8 rounded-full text-muted-foreground hover:text-foreground hover:bg-accent/50 active:scale-95`,children:(0,Z.jsx)(zn,{className:`h-4 w-4`})}):(0,Z.jsx)(Q,{variant:C?`default`:`ghost`,size:`icon`,onClick:n,disabled:!C,title:`Send (Enter)`,className:X(`h-8 w-8 rounded-full transition-all duration-150`,C?`shadow-sm hover:shadow-md active:scale-95`:`text-muted-foreground`),children:(0,Z.jsx)(Ln,{className:`h-4 w-4`})}),f&&(0,Z.jsx)(`div`,{className:`ml-1 flex items-center`,children:f}),g&&(0,Z.jsx)(`div`,{className:`flex items-center`,children:g})]})]})]})})};function Kn({threshold:e=10,deps:t=[]}={}){let n=(0,I.useRef)(null),[r,i]=(0,I.useState)(!0),a=(0,I.useRef)(0),o=(0,I.useCallback)(()=>{let e=n.current;e&&(e.scrollTop=e.scrollHeight)},[]),s=(0,I.useCallback)(()=>{let t=n.current;t&&i(t.scrollHeight-t.scrollTop-t.clientHeight<=e)},[e]);return(0,I.useEffect)(()=>{r&&o(),n.current&&(a.current=n.current.scrollHeight)},t),(0,I.useEffect)(()=>{if(!r)return;let e=n.current;if(!e)return;let t=null,i=()=>{e&&(e.scrollHeight!==a.current&&(o(),a.current=e.scrollHeight),t=requestAnimationFrame(i))};return t=requestAnimationFrame(i),()=>{t&&cancelAnimationFrame(t)}},[r,o]),(0,I.useEffect)(()=>{let e=n.current;if(e)return e.addEventListener(`scroll`,s),()=>{e.removeEventListener(`scroll`,s)}},[s]),{containerRef:n,isSticky:r,scrollToBottom:o,setSticky:i}}var qn=e=>(0,Z.jsx)(Gn,{...e}),Jn=({content:e})=>{let t=I.useMemo(()=>({pre({children:e}){let t=Array.isArray(e)?e[0]:e;if(I.isValidElement(t)&&t.type===`code`){let e=t,n=e.props.className,r=/language-(\w+)/.exec(n||``),o=I.Children.toArray(e.props.children).map(e=>typeof e==`string`?e:``).join(``).replace(/\n$/,``);return r?(0,Z.jsx)(i,{style:a,language:r[1],PreTag:`div`,className:`rounded-lg my-2 overflow-auto w-full max-w-full min-w-0`,wrapLongLines:!0,customStyle:{whiteSpace:`pre`,overflowX:`auto`,overflowY:`auto`,maxWidth:`100%`},children:o}):(0,Z.jsx)(`pre`,{className:`rounded-lg my-2 overflow-x-auto overflow-y-auto w-full max-w-full min-w-0 bg-muted p-2`,style:{maxWidth:`100%`,overflowX:`auto`},children:(0,Z.jsx)(`code`,{className:`text-sm whitespace-pre break-normal`,style:{overflowWrap:`anywhere`,wordBreak:`break-word`},children:o})})}return(0,Z.jsx)(`pre`,{className:`rounded-lg my-2 overflow-x-auto overflow-y-auto w-full max-w-full min-w-0 bg-muted p-2`,style:{maxWidth:`100%`,overflowX:`auto`},children:e})},code(e){let{inline:t,className:n,children:r}=e,o=n||``,s=I.Children.toArray(r).map(e=>typeof e==`string`?e:``).join(``).replace(/\n$/,``);if(t||!/language-/.test(o))return(0,Z.jsx)(`code`,{className:`bg-muted px-1.5 py-0.5 rounded text-sm break-words align-baseline`,style:{overflowWrap:`anywhere`,wordBreak:`break-word`,display:`inline`,whiteSpace:`normal`},children:r});let c=/language-(\w+)/.exec(o);return c?(0,Z.jsx)(i,{style:a,language:c[1],PreTag:`div`,className:`rounded-lg my-2 overflow-auto w-full max-w-full min-w-0`,wrapLongLines:!0,customStyle:{whiteSpace:`pre`,overflowX:`auto`,overflowY:`auto`,maxWidth:`100%`},children:s}):(0,Z.jsx)(`pre`,{className:`rounded-lg my-2 overflow-x-auto overflow-y-auto w-full max-w-full min-w-0 bg-muted p-2`,style:{maxWidth:`100%`,overflowX:`auto`},children:(0,Z.jsx)(`code`,{className:`text-sm whitespace-pre break-normal`,style:{overflowWrap:`anywhere`,wordBreak:`break-word`},children:s})})},p({children:e,...t}){return(0,Z.jsx)(`p`,{className:`mb-2 leading-relaxed break-words`,...t,children:e})},h1({children:e}){return(0,Z.jsx)(`h1`,{className:`text-2xl font-bold mt-6 mb-4`,children:e})},h2({children:e}){return(0,Z.jsx)(`h2`,{className:`text-xl font-bold mt-6 mb-4`,children:e})},h3({children:e}){return(0,Z.jsx)(`h3`,{className:`text-lg font-bold mt-6 mb-4`,children:e})},ul({children:e}){return(0,Z.jsx)(`ul`,{className:`list-disc pl-6 mb-4`,children:e})},ol({children:e}){return(0,Z.jsx)(`ol`,{className:`list-decimal pl-6 mb-4`,children:e})},li({children:e}){return(0,Z.jsx)(`li`,{className:`mb-1 leading-relaxed break-words`,children:e})},a({href:e,children:t}){return(0,Z.jsx)(`a`,{href:e,target:`_blank`,rel:`noopener noreferrer`,className:`text-primary hover:underline`,children:t})},blockquote({children:e}){return(0,Z.jsx)(`blockquote`,{className:`border-l-4 border-border pl-4 my-4 py-1 bg-muted rounded-r`,children:e})},table({children:e}){return(0,Z.jsx)(`div`,{className:`overflow-x-auto my-4 mb-2 rounded-lg border border-border shadow-sm`,children:(0,Z.jsx)(`table`,{className:`w-full border-collapse`,children:e})})},thead({children:e}){return(0,Z.jsx)(`thead`,{className:`bg-muted/50`,children:e})},tbody({children:e}){return(0,Z.jsx)(`tbody`,{className:`divide-y divide-border`,children:e})},tr({children:e}){return(0,Z.jsx)(`tr`,{className:`hover:bg-muted/30 transition-colors`,children:e})},th({children:e}){return(0,Z.jsx)(`th`,{className:`px-4 py-3 text-left text-sm font-semibold text-foreground border-b border-border`,children:e})},td({children:e}){return(0,Z.jsx)(`td`,{className:`px-4 py-3 text-sm text-foreground border-b border-border/50`,children:e})}}),[]);return(0,Z.jsxs)(`div`,{className:`prose prose-sm dark:prose-invert max-w-none w-full max-w-full min-w-0 overflow-hidden`,style:{overflowX:`hidden`},children:[(0,Z.jsx)(`style`,{children:`
        .prose p:last-of-type { margin-bottom: 0 !important; }
        .prose pre { overflow-x: auto !important; max-width: 100% !important; }
        .prose code { overflow-wrap: anywhere !important; word-break: break-word !important; }
      `}),(0,Z.jsx)(f,{remarkPlugins:[p],components:t,children:e})]})},Yn=I.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(me,{ref:n,className:X(`relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full`,e),...t}));Yn.displayName=me.displayName;var Xn=I.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(F,{ref:n,className:X(`aspect-square h-full w-full`,e),...t}));Xn.displayName=F.displayName;var Zn=I.forwardRef(({className:e,...t},n)=>(0,Z.jsx)(M,{ref:n,className:X(`flex h-full w-full items-center justify-center rounded-full bg-muted`,e),...t}));Zn.displayName=M.displayName;var Qn=({className:e})=>(0,Z.jsxs)(`div`,{className:X(`flex items-center py-1`,e),children:[(0,Z.jsx)(`style`,{children:`
        @keyframes dotBounce {
          0%, 100% {
            transform: translateY(2px);
          }
          50% {
            transform: translateY(-2px);
          }
        }
      `}),(0,Z.jsxs)(`div`,{className:`flex items-center space-x-1`,children:[(0,Z.jsx)(`div`,{className:`w-2 h-2 bg-blue-500 rounded-full`,style:{animation:`dotBounce 1.4s infinite`,animationDelay:`-0.3s`}}),(0,Z.jsx)(`div`,{className:`w-2 h-2 bg-blue-500 rounded-full`,style:{animation:`dotBounce 1.4s infinite`,animationDelay:`-0.15s`}}),(0,Z.jsx)(`div`,{className:`w-2 h-2 bg-blue-500 rounded-full`,style:{animation:`dotBounce 1.4s infinite`,animationDelay:`0s`}})]})]}),$n=({actions:e,className:t,showOnHover:n=!0})=>{let[r,i]=I.useState(!n),a=I.useCallback(()=>{n&&i(!0)},[n]),o=I.useCallback(()=>{n&&i(!1)},[n]);return e.length===0?null:(0,Z.jsx)(`div`,{className:X(`flex items-center gap-1 transition-all duration-200 ease-in-out`,r?`opacity-100 translate-y-0`:`opacity-0 translate-y-1`,t),onMouseEnter:a,onMouseLeave:o,children:e.map(e=>(0,Z.jsxs)(`button`,{onClick:e.onClick,disabled:e.disabled,className:`flex items-center justify-center size-9 rounded-md text-muted-foreground hover:text-foreground hover:bg-accent`,title:e.label,children:[e.icon,(0,Z.jsx)(`span`,{className:`sr-only`,children:e.label})]},e.id))})},er={copy:(0,Z.jsx)(jn,{className:`h-4 w-4`}),regenerate:(0,Z.jsx)(In,{className:`h-4 w-4`}),like:(0,Z.jsx)(Bn,{className:`h-4 w-4`}),dislike:(0,Z.jsx)(Vn,{className:`h-4 w-4`}),share:(0,Z.jsx)(Rn,{className:`h-4 w-4`})},tr=({toolInvocation:e,toolRenderers:t,onToolResult:n})=>{let r=t[e.toolName];return r?r.render(e,e=>{n&&n(e)}):e.status===`result`?(0,Z.jsxs)(`div`,{className:`rounded-lg border bg-background p-2 w-full max-w-full min-w-0 overflow-hidden`,children:[(0,Z.jsxs)(`div`,{className:`mb-2 flex items-center justify-between`,children:[(0,Z.jsx)(`span`,{className:`text-sm font-medium`,children:`工具调用结果`}),(0,Z.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.toolName})]}),(0,Z.jsx)(`div`,{className:`rounded-md bg-muted p-2 w-full max-w-full min-w-0 overflow-auto`,children:(0,Z.jsx)(`pre`,{className:`text-sm whitespace-pre-wrap break-all`,style:{maxHeight:`12rem`,overflowY:`auto`,overflowX:`auto`,wordBreak:`break-word`},children:JSON.stringify(e.result,null,2)})})]}):(0,Z.jsxs)(`div`,{className:`rounded-lg border bg-background p-2 w-full max-w-full min-w-0 overflow-hidden`,children:[(0,Z.jsxs)(`div`,{className:`mb-2 flex items-center justify-between`,children:[(0,Z.jsxs)(`span`,{className:`text-sm font-medium`,children:[`工具调用`,e.status===`partial-call`&&(0,Z.jsx)(`span`,{className:`ml-2 text-xs text-muted-foreground`,children:`准备参数中…`}),e.status===`call`&&(0,Z.jsx)(`span`,{className:`ml-2 text-xs text-muted-foreground`,children:`执行中…`})]}),(0,Z.jsx)(`span`,{className:`text-xs text-muted-foreground`,children:e.toolName})]}),(0,Z.jsx)(`div`,{className:`rounded-md bg-muted p-2 w-full max-w-full min-w-0 overflow-auto`,children:(0,Z.jsx)(`pre`,{className:`text-sm whitespace-pre-wrap break-all`,style:{maxHeight:`12rem`,overflowY:`auto`,overflowX:`auto`,wordBreak:`break-word`},children:typeof e.args==`string`?e.args:JSON.stringify(e.args,null,2)})})]})};function nr(e){let t=[];for(let n of e.parts)n.type===`text`&&t.push(n.text);return t.join(`

`)}function rr(e){return e.parts.some(e=>e.type===`text`&&e.text.trim().length>0)}var ir=(e,t={})=>{let[n,r]=(0,I.useState)(!1),[i,a]=(0,I.useState)(!1),{onCopy:o,onRegenerate:s,onLike:c,onDislike:l,onShare:u}=t,d=(0,I.useCallback)(async()=>{if(!rr(e)||n)return;let t=nr(e);r(!0);try{await navigator.clipboard.writeText(t),a(!0),o?.(t),setTimeout(()=>{a(!1)},2e3)}catch(e){console.error(`Failed to copy text:`,e);try{let e=document.createElement(`textarea`);e.value=t,e.style.position=`fixed`,e.style.left=`-999999px`,e.style.top=`-999999px`,document.body.appendChild(e),e.focus(),e.select(),document.execCommand(`copy`),document.body.removeChild(e),a(!0),o?.(t),setTimeout(()=>{a(!1)},2e3)}catch(e){console.error(`Fallback copy failed:`,e)}}finally{r(!1)}},[e,n,o]),f=(0,I.useCallback)(()=>{s?.(e.id)},[e.id,s]),p=(0,I.useCallback)(()=>{c?.(e.id)},[e.id,c]),m=(0,I.useCallback)(()=>{l?.(e.id)},[e.id,l]),h=(0,I.useCallback)(()=>{u?.(e.id)},[e.id,u]),g=[];return e.role===`assistant`&&(rr(e)&&g.push({id:`copy`,label:i?`已复制`:`复制`,icon:i?I.createElement(`svg`,{className:`h-4 w-4 text-green-600`,fill:`none`,viewBox:`0 0 24 24`,stroke:`currentColor`},I.createElement(`path`,{strokeLinecap:`round`,strokeLinejoin:`round`,strokeWidth:2,d:`M5 13l4 4L19 7`})):er.copy,onClick:d,disabled:n}),s&&g.push({id:`regenerate`,label:`重新生成`,icon:er.regenerate,onClick:f}),c&&g.push({id:`like`,label:`点赞`,icon:er.like,onClick:p}),l&&g.push({id:`dislike`,label:`点踩`,icon:er.dislike,onClick:m}),u&&g.push({id:`share`,label:`分享`,icon:er.share,onClick:h})),{actions:g,isCopying:n,copySuccess:i}},ar=({uiMessage:e,toolRenderers:t,onToolResult:n,className:r,showAvatar:i=!0,isPending:a=!1,onMessageCopy:o,onMessageRegenerate:c,onMessageLike:l,onMessageDislike:u,onMessageShare:d})=>{let f=e.role===`user`,{actions:p}=ir(e,{onCopy:o,onRegenerate:c,onLike:l,onDislike:u,onShare:d});return(0,Z.jsx)(`div`,{className:s(`flex w-full p-2 min-w-0 group`,f?`justify-end`:`justify-start`,r),style:{overflowX:`hidden`,maxWidth:`100%`},children:(0,Z.jsxs)(`div`,{className:s(`flex flex-col gap-2 min-w-0 relative`,f?`items-end w-auto`:`items-start w-auto`),style:{maxWidth:`100%`,overflowX:`hidden`},children:[i&&(0,Z.jsxs)(Yn,{className:`h-10 w-10 shrink-0`,children:[(0,Z.jsx)(Xn,{src:``,alt:f?`User`:`Assistant`}),(0,Z.jsx)(Zn,{className:`bg-primary text-primary-foreground`,children:f?(0,Z.jsx)(Un,{className:`h-5 w-5`}):(0,Z.jsx)(An,{className:`h-5 w-5`})})]}),(0,Z.jsx)(`div`,{className:`min-w-0 overflow-hidden rounded-lg px-3 py-4 ${f?`bg-primary text-primary-foreground w-auto`:`bg-muted text-foreground w-auto`}`,style:{overflowX:`hidden`,maxWidth:`100%`},children:(0,Z.jsx)(`div`,{className:`[&>*:last-child]:mb-0`,children:a?(0,Z.jsx)(Qn,{}):e.parts.map((e,r)=>e.type===`text`?(0,Z.jsx)(`div`,{className:`break-words min-w-0`,style:{overflowX:`hidden`,maxWidth:`100%`},children:(0,Z.jsx)(Jn,{content:e.text})},r):e.type===`tool-invocation`?(0,Z.jsx)(`div`,{className:`mt-1`,children:(0,Z.jsx)(tr,{toolInvocation:e.toolInvocation,toolRenderers:t,onToolResult:n})},r):null)})}),!f&&!a&&p.length>0&&(0,Z.jsx)(`div`,{className:`mt-1`,children:(0,Z.jsx)($n,{actions:p,showOnHover:!1})})]})})},or=({promptsProps:e})=>{let{items:t,onItemClick:n}=e;return!t||t.length===0?null:(0,Z.jsx)(`div`,{className:`space-y-3`,children:(0,Z.jsx)(`div`,{className:`grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2`,children:t.map(e=>(0,Z.jsx)(Q,{variant:`outline`,size:`sm`,className:X(`h-auto p-3 text-left justify-start hover:bg-accent/50 transition-all duration-200`,`group hover:shadow-sm hover:border-primary/20 hover:scale-[1.02]`,`focus-visible:ring-2 focus-visible:ring-primary/20 focus-visible:border-primary/40`),onClick:()=>n?.(e),onKeyDown:t=>{(t.key===`Enter`||t.key===` `)&&(t.preventDefault(),n?.(e))},role:`button`,tabIndex:0,"aria-label":`选择提示: ${e.prompt}`,children:(0,Z.jsx)(`span`,{className:`text-sm font-medium text-foreground group-hover:text-primary transition-colors duration-200 leading-relaxed`,children:e.prompt})},e.id))})})},sr=({uiMessages:e,toolRenderers:t,onToolResult:n,input:r,senderProps:i,onInputChange:a,onSend:o,isAgentResponding:c,onAbort:l,promptsProps:u,messageItemProps:d,aboveInputComponent:f,inputExtensions:p=[],onBeforeSend:m,onSendDraft:h,meta:g,onMetaChange:_})=>{let{containerRef:v,isSticky:y,scrollToBottom:b,setSticky:x}=Kn({deps:[e]}),[S]=at({onAppendText:e=>a(r+e)}),[ee,C]=I.useState({}),w=g??ee,te=I.useCallback(e=>{let t=typeof e==`function`?e({text:r,meta:w}):e;t.text!==void 0&&t.text!==r&&a(t.text),t.meta!==void 0&&(_?_(t.meta):C(t.meta))},[r,w,a,_,S.attachments]),T=I.useMemo(()=>{let e={};for(let t of p){let n=t.placement??`inside-left`;n===`toolbar-left`&&(n=`top-left`),n===`toolbar-right`&&(n=`top-right`),n===`below`&&(n=`bottom-left`),e[n]||(e[n]=[]),e[n].push(t)}return e},[p]),E=I.useMemo(()=>({draft:{text:r,meta:w},setDraft:te,isAgentResponding:c,requestAbort:l}),[r,w,te,c,l]),D=I.useCallback(async()=>{let e={text:r,meta:w},t=e=>typeof e==`object`&&!!e&&`abort`in e;if(m){let n=await m(e);if(t(n))return{aborted:!0};e=n}for(let n of p){if(!n.beforeSend)continue;let r=await n.beforeSend(e);if(t(r))return{aborted:!0};e=r}return{aborted:!1,draft:e}},[r,w,m,p]),O=I.useCallback(async()=>{if(m||p&&p.length>0||h){let e=await D();if(e.aborted)return;let t=e.draft;h?h(t):o()}else o();setTimeout(()=>{x(!0),b()},0)},[m,p,h,o,D,x,b]);return(0,Z.jsxs)(`div`,{className:`flex h-full flex-col`,children:[(0,Z.jsxs)(`div`,{ref:v,className:s(`flex-1 overflow-y-auto overflow-x-hidden px-4 py-2`,y?` sticky-bottom`:``),style:{overflowX:`hidden`,maxWidth:`100%`},children:[e.map((e,r)=>(0,Z.jsx)(ar,{uiMessage:e,toolRenderers:t,onToolResult:n,...d},r)),c&&e.length>0&&e[e.length-1].role!==`assistant`&&(0,Z.jsx)(ar,{uiMessage:{id:`generating-placeholder`,role:`assistant`,parts:[]},toolRenderers:t,onToolResult:n,isPending:!0,...d},`generating-placeholder`)]}),u&&e.length===0&&(0,Z.jsx)(`div`,{className:`border-t border-border/50 bg-gradient-to-b from-muted/30 to-background/95 backdrop-blur-sm px-4 py-6`,children:(0,Z.jsx)(or,{promptsProps:u})}),f&&(0,Z.jsx)(`div`,{className:`border-t border-border/50 bg-muted/20 px-4 py-3`,children:f}),(0,Z.jsx)(`div`,{className:`border-t border-border/50 bg-background/95 backdrop-blur-sm px-4 py-4 flex-shrink-0`,children:(0,Z.jsx)(qn,{input:r,...i,onInputChange:e=>{a(e)},onSend:O,isAgentResponding:c,onAbort:l,insideLeftSlot:T[`inside-left`]?.map(e=>(0,Z.jsx)(I.Fragment,{children:e.render(E)},e.id)),insideRightSlot:T[`inside-right`]?.map(e=>(0,Z.jsx)(I.Fragment,{children:e.render(E)},e.id)),headerLeftSlot:T[`top-left`]?.map(e=>(0,Z.jsx)(I.Fragment,{children:e.render(E)},e.id)),headerRightSlot:T[`top-right`]?.map(e=>(0,Z.jsx)(I.Fragment,{children:e.render(E)},e.id)),footerLeftSlot:T[`bottom-left`]?.map(e=>(0,Z.jsx)(I.Fragment,{children:e.render(E)},e.id)),footerRightSlot:T[`bottom-right`]?.map(e=>(0,Z.jsx)(I.Fragment,{children:e.render(E)},e.id))})})]})},cr=(0,I.createContext)(null),lr=I.forwardRef(({agentChatController:e,toolRenderers:t,className:n,senderProps:r,promptsProps:i,messageItemProps:a,aboveInputComponent:o,inputExtensions:s,onBeforeSend:c,meta:l,onMetaChange:u},d)=>{let[f,p]=(0,I.useState)(``),{messages:m,isAgentResponding:h}=rt(e),{handleSendMessage:g,handleAddToolResult:_,reset:v,addMessages:y,abortAgentRun:b,handleAddMessages:x}=e;return(0,I.useImperativeHandle)(d,()=>({reset:v,addMessages:x}),[v,y]),(0,Z.jsx)(`div`,{className:n,children:(0,Z.jsx)(cr.Provider,{value:e,children:(0,Z.jsx)(sr,{senderProps:r,uiMessages:m,toolRenderers:t,onToolResult:_,input:f,onInputChange:p,onSend:async()=>{h||(await g(f),p(``))},onSendDraft:async e=>{if(!h){let t=(e?.text??``).toString();if(t.trim().length===0)return;await g(t),p(``)}},isAgentResponding:h,onAbort:b,promptsProps:i,messageItemProps:a,aboveInputComponent:o,inputExtensions:s,onBeforeSend:c,meta:l,onMetaChange:u})})})}),ur=({title:e,isMaximized:t,isHeightMaximized:n,onMaximize:r,onHeightMaximize:i,onClose:a,children:o,actions:s,width:c=400,height:l=600})=>(0,Z.jsxs)(`div`,{className:`fixed bottom-5 right-5 flex flex-col rounded-lg bg-background shadow-lg transition-all duration-300 ease-in-out z-50`,style:{width:t?`calc(100vw - 40px)`:`${c}px`,height:t||n?`calc(100vh - 40px)`:`${l}px`,bottom:`20px`,right:`20px`},children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between border-b border-border px-4 py-3 cursor-pointer select-none`,children:[(0,Z.jsx)(`span`,{className:`font-medium text-foreground`,children:e}),(0,Z.jsxs)(`div`,{className:`flex items-center space-x-2`,onClick:e=>{e.stopPropagation()},children:[s,(0,Z.jsx)(Q,{size:`icon`,variant:`ghost`,onClick:i,children:(0,Z.jsx)(kn,{className:`h-4 w-4`})}),(0,Z.jsx)(Q,{size:`icon`,variant:`ghost`,onClick:r,children:t?(0,Z.jsx)(Fn,{className:`h-4 w-4`}):(0,Z.jsx)(Nn,{className:`h-4 w-4`})}),(0,Z.jsx)(Q,{size:`icon`,variant:`ghost`,onClick:a,children:(0,Z.jsx)(Wn,{className:`h-4 w-4`})})]})]}),(0,Z.jsx)(`div`,{className:`flex-1 overflow-hidden flex flex-col`,children:o})]});I.forwardRef(({className:e,...t},n)=>{let[r,i]=(0,I.useState)(!1),[a,o]=(0,I.useState)(!1),[c,l]=(0,I.useState)(!0),u=()=>{l(!1)},d=()=>{l(!0)},f=()=>{o(!a),r&&i(!1)},p=(0,I.useRef)(null);return c?(0,Z.jsx)(ur,{title:`AI Assistant`,isMaximized:r,isHeightMaximized:a,onMaximize:()=>{i(!r),a&&o(!1)},onHeightMaximize:f,onClose:u,actions:[(0,Z.jsx)(Q,{variant:`ghost`,size:`icon`,onClick:()=>{p.current?.reset()},children:(0,Z.jsx)(Hn,{className:`h-4 w-4`})},`clear`)],children:(0,Z.jsx)(lr,{ref:e=>{p.current=e,typeof n==`function`?n(e):n&&(n.current=e)},...t,className:s(`h-full`,e)})}):(0,Z.jsx)(Q,{variant:`default`,size:`icon`,onClick:d,className:`fixed bottom-5 right-5 h-12 w-12 rounded-full shadow-lg`,children:(0,Z.jsx)(Pn,{className:`h-6 w-6`})})});var dr=e=>({name:e.name,description:e.description,parameters:e.parameters}),fr=e=>e.map(e=>({name:e.name,description:e.description,parameters:e.parameters})),pr=e=>Object.fromEntries(e.filter(e=>e.execute).map(e=>[e.name,e.execute])),mr=e=>Object.fromEntries(e.filter(e=>e.render).map(e=>[e.name,{render:e.render,definition:dr(e)}])),hr=e=>({toolDefs:(0,I.useMemo)(()=>fr(e),[e]),toolExecutors:(0,I.useMemo)(()=>pr(e),[e]),toolRenderers:(0,I.useMemo)(()=>mr(e),[e])});const gr=({message:e})=>{let t=(e.parts||[]).filter(e=>e.type===`tool-invocation`);return t.length?(0,Z.jsx)(`div`,{className:`mt-2 space-y-2`,children:t.map((e,t)=>(0,Z.jsx)(_r,{invocation:e.toolInvocation},t))}):null};var _r=({invocation:e})=>{let{t}=he(),[n,r]=(0,I.useState)(!1),i=e.status===`call`||e.status===`partial-call`,a=e.status===`error`,o=typeof e.args==`string`?e.args:JSON.stringify(e.args,null,2),s=e.result!==void 0||e.error&&e.error.length>0,c=e.error&&e.error.length?`error: ${e.error}`:e.result===void 0?void 0:typeof e.result==`string`?e.result:JSON.stringify(e.result,null,2);return(0,Z.jsxs)(`div`,{className:`rounded-md border border-dashed border-border/60 bg-muted/40 px-3 py-2 text-xs text-muted-foreground`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center justify-between mb-1`,children:[(0,Z.jsxs)(`div`,{className:`flex items-center gap-1 font-semibold text-[11px] uppercase tracking-wide min-w-0 flex-1`,children:[(0,Z.jsxs)(`span`,{className:`truncate max-w-full`,children:[`Tool: `,e.toolName]}),(0,Z.jsxs)(`span`,{className:`ml-1 text-[10px] font-normal opacity-70 whitespace-nowrap`,children:[`(`,e.status,`)`]}),i&&(0,Z.jsx)(te,{className:`h-3 w-3 text-amber-500 animate-spin`}),a&&(0,Z.jsx)(`span`,{className:`ml-1 text-[11px] text-red-500 whitespace-nowrap`,children:t(`toolInvocation.error`)})]}),(0,Z.jsx)(`button`,{type:`button`,onClick:()=>r(e=>!e),className:`text-muted-foreground hover:text-foreground px-1 py-0.5 rounded-sm`,"aria-label":t(n?`toolInvocation.collapse`:`toolInvocation.expand`),children:n?(0,Z.jsx)(C,{className:`h-3.5 w-3.5`}):(0,Z.jsx)(_,{className:`h-3.5 w-3.5`})})]}),n&&(0,Z.jsxs)(`div`,{className:`space-y-1 mt-1`,children:[(0,Z.jsxs)(`div`,{className:`text-[11px] font-mono opacity-80`,children:[(0,Z.jsx)(`span`,{className:`font-semibold`,children:`args:`}),` `,(0,Z.jsx)(`span`,{className:`break-all whitespace-pre-wrap`,children:o})]}),s&&c&&(0,Z.jsxs)(`div`,{className:`text-[11px] font-mono opacity-80 max-h-40 overflow-y-auto overflow-x-auto pr-1`,children:[(0,Z.jsx)(`span`,{className:`font-semibold`,children:`result:`}),` `,(0,Z.jsx)(`span`,{className:`break-all whitespace-pre-wrap`,children:c})]})]})]})};const vr={name:`get_workspace_context`,description:`获取当前浏览器标签页、编辑器和项目相关的上下文信息，用于更好地理解用户问题。`,parameters:{type:`object`,properties:{includeBrowserTab:{type:`boolean`,description:`是否包含当前浏览器标签页信息（URL、标题等）。`},includeEditor:{type:`boolean`,description:`是否包含当前编辑器打开文件的内容和元信息。`},includeProject:{type:`boolean`,description:`是否包含项目级别的上下文（当前文件、最近文件等）。`}},additionalProperties:!1},async execute(e){let{includeBrowserTab:t=!0,includeEditor:n=!0,includeProject:r=!1}=e??{};return await Oe.getFullContext({includeBrowserTab:t,includeEditor:n,includeProject:r})}};var yr=new P;function br(e){let t=e.spaceId,n=e.path;if(e.uri&&(t=ge.getSpaceIdFromUri(e.uri),n=ge.getInSpacePathFromUri(e.uri)),!t)throw Error(`fs_* 工具需要空间信息。请在调用时提供 spaceId 或 uri。`);let r=n&&n.length?n:`/`;return{spaceId:t,path:r}}const xr={name:`fs_readdir`,description:`列出指定空间路径下的目录内容。对应 Node.js fs.readdir（只读）。`,parameters:{type:`object`,properties:{uri:{type:`string`,description:`完整空间 URI，例如 "space://<spaceId>/path/to/dir"。若提供，则可省略 spaceId 和 path。`},spaceId:{type:`string`,description:`空间 ID。若未提供 uri 时，必须提供 spaceId + path。`},path:{type:`string`,description:`空间内路径，例如 "/"、"src" 或 "src/components"。默认值为 "/"。`}},required:[],additionalProperties:!1},async execute(e){let{spaceId:t,path:n}=br(e);return{kind:`directory`,path:n,entries:(await yr.readDirectory(t,n)).map(([e,t])=>{if(le(n===`/`?e:`${n}/${e}`))return null;let r=`other`;return t===fe.File?r=`file`:t===fe.Directory&&(r=`directory`),{name:e,type:r}}).filter(Boolean)}}},Sr={name:`fs_readFile`,description:`读取指定空间中文件的文本内容。对应 Node.js fs.readFile（只读）。`,parameters:{type:`object`,properties:{uri:{type:`string`,description:`完整空间 URI，例如 "space://<spaceId>/path/to/file.md"。若提供，则可省略 spaceId 和 path。`},spaceId:{type:`string`,description:`空间 ID。若未提供 uri 时，必须提供 spaceId + path。`},path:{type:`string`,description:`空间内文件路径，例如 "README.md" 或 "src/index.ts"。`},maxBytes:{type:`number`,description:`读取文件时最多返回的字符数，默认约 8000 字符。避免返回过长内容。`}},required:[],additionalProperties:!1},async execute(e){let{spaceId:t,path:n}=br(e);if(!n||n===`/`)throw Error(`fs_readFile 需要提供具体文件路径 path，而不是目录。`);if(k(n))return{kind:`binary`,path:n,note:`目标看起来是二进制文件，跳过内容读取。`,size:(yr.stat?await yr.stat(t,n):{})?.size};let r=await yr.readFile(t,n),i=new TextDecoder().decode(r),a=typeof e.maxBytes==`number`&&e.maxBytes>0?e.maxBytes:8e3,o=i,s=!1;return i.length>a&&(o=i.slice(0,a),s=!0),{kind:`file`,path:n,content:o,truncated:s}}},Cr={name:`fs_stat`,description:`获取指定空间路径的文件或目录信息（size、mtime 等）。对应 Node.js fs.stat（只读）。`,parameters:{type:`object`,properties:{uri:{type:`string`,description:`完整空间 URI，例如 "space://<spaceId>/path/to/target"。若提供，则可省略 spaceId 和 path。`},spaceId:{type:`string`,description:`空间 ID。若未提供 uri 时，必须提供 spaceId + path。`},path:{type:`string`,description:`空间内路径，例如 "README.md" 或 "src"。默认值为 "/"。`}},required:[],additionalProperties:!1},async execute(e){let{spaceId:t,path:n}=br(e);if(!yr.stat)return{kind:`stat`,path:n};let r=await yr.stat(t,n);return{kind:`stat`,path:n,size:r.size,mtime:r.mtime}}};function wr(){let e=be();if(!e)throw Error(N(`excalidraw.tools.noCanvas`));let t=e.getScene();return{handle:e,scene:t,elements:t.elements??[]}}function Tr(e){let t=e.toLowerCase();if(t.includes(`db`)||t.includes(`数据库`))return`database`;if(t.includes(`cache`)||t.includes(`redis`))return`cache`;if(t.includes(`api`)||t.includes(`service`))return`service`}function Er(e){let t=e;return{x:(t.x??0)+(t.width??0)/2,y:(t.y??0)+(t.height??0)/2}}function Dr(e,t){let n=e.x-t.x,r=e.y-t.y;return n*n+r*r}function Or(e){let t=e,n=t.points??[],r=t.x??0,i=t.y??0;if(!Array.isArray(n)||n.length<2)return{start:{x:r,y:i},end:{x:r+(t.width??0),y:i+(t.height??0)}};let a=n[0],o=n[n.length-1];return{start:{x:r+a[0],y:i+a[1]},end:{x:r+o[0],y:i+o[1]}}}function kr(e,t){if(!t)return null;let n=t.trim(),r=n.toLowerCase(),i=e.find(e=>e.id===n);return i||(i=e.find(e=>{let t=e;return t.type===`text`?(t.text??``).trim().toLowerCase()===r:!1}),i)?i:(i=e.find(e=>{let t=e;return t.type===`text`?(t.text??``).toLowerCase().includes(r):!1}),i??null)}function Ar(e){if(!e.length)return null;let t=1/0,n=1/0,r=-1/0,i=-1/0;for(let a of e){let e=a,o=e.x??0,s=e.y??0,c=e.width??0,l=e.height??0;t=Math.min(t,o),n=Math.min(n,s),r=Math.max(r,o+c),i=Math.max(i,s+l)}return{minX:t,minY:n,maxX:r,maxY:i}}function jr(e){let{baseId:t,label:n,center:r}=e,i=Date.now(),a=`${t}-box`,o=t,s=r.x-180/2,c={type:`rectangle`,version:1,versionNonce:i,isDeleted:!1,id:a,fillStyle:`solid`,strokeWidth:2,strokeStyle:`solid`,roughness:1,opacity:100,angle:0,x:s,y:r.y-80/2,strokeColor:`#1e293b`,backgroundColor:`#e0f2fe`,width:180,height:80,seed:i,groupIds:[],frameId:null,roundness:{type:3},boundElements:[{type:`text`,id:o}],updated:i,link:null,locked:!1},l=s+40/2,u=r.y-28/2;return[c,{type:`text`,version:1,versionNonce:i+1,isDeleted:!1,id:o,fillStyle:`solid`,strokeWidth:2,strokeStyle:`solid`,roughness:1,opacity:100,angle:0,x:l,y:u,strokeColor:`#0f172a`,backgroundColor:`transparent`,width:140,height:28,seed:i+1,groupIds:[],frameId:null,roundness:null,boundElements:null,updated:i+1,link:null,locked:!1,fontSize:18,fontFamily:1,text:n,textAlign:`center`,verticalAlign:`middle`,containerId:a,originalText:n,lineHeight:1.25,baseline:22}]}function Mr(e,t){let n=Date.now(),r=Er(e),i=Er(t),a=i.x-r.x,o=i.y-r.y,s=Math.max(Math.abs(a),1),c=Math.max(Math.abs(o),1);return{type:`arrow`,version:1,versionNonce:n,isDeleted:!1,id:`arrow-${n}-${Math.floor(Math.random()*1e4)}`,fillStyle:`solid`,strokeWidth:2,strokeStyle:`solid`,roughness:1,opacity:100,angle:0,x:r.x,y:r.y,strokeColor:`#1e293b`,backgroundColor:`transparent`,width:s,height:c,seed:n,groupIds:[],frameId:null,roundness:null,boundElements:[],updated:n,link:null,locked:!1,startBinding:null,endBinding:null,points:[[0,0],[a,o]],lastCommittedPoint:[a,o],startArrowhead:null,endArrowhead:`arrow`}}const Nr={name:`excalidraw_analyze`,description:N(`excalidraw.tools.getSummaryDescription`),parameters:{type:`object`,properties:{maxNodes:{type:`number`,description:N(`excalidraw.tools.getSummaryMaxNodesDescription`)}},required:[],additionalProperties:!1},async execute(e){let{elements:t}=wr(),n=typeof e?.maxNodes==`number`&&e.maxNodes>0?e.maxNodes:void 0,r=[];for(let e of t){let t=e;if(t.type===`text`&&typeof t.text==`string`){let n=t.text.trim();if(!n)continue;let i=Er(e);r.push({id:e.id,label:n,kind:Tr(n),position:i})}}let i=n??r.length,a=r.slice(0,i),o=new Map;for(let e of r)o.set(e.id,e);let s=[];for(let e of t){let t=e;if(t.type!==`arrow`)continue;let n=null,i=null,a=t.startBinding,c=t.endBinding;if(a?.elementId&&c?.elementId&&typeof a.elementId==`string`&&typeof c.elementId==`string`)n=a.elementId,i=c.elementId;else{let{start:t,end:a}=Or(e),o=null,s=null;for(let e of r){if(!e.position)continue;let n=Dr(t,e.position),r=Dr(a,e.position);(!o||n<o.dist)&&(o={id:e.id,dist:n}),(!s||r<s.dist)&&(s={id:e.id,dist:r})}n=o?.id??null,i=s?.id??null}!n||!i||n===i||!o.has(n)||!o.has(i)||s.push({id:e.id,from:n,to:i})}let c=i*4,l=s.slice(0,c);return{nodeCount:r.length,edgeCount:s.length,nodes:a,edges:l}}},Pr={name:`excalidraw_ai_generate_diagram`,description:N(`excalidraw.tools.generateDiagramDescription`),parameters:{type:`object`,properties:{prompt:{type:`string`,description:N(`excalidraw.tools.generateDiagramPromptDescription`)},mode:{type:`string`,enum:[`append`,`replace`],description:N(`excalidraw.tools.generateDiagramModeDescription`),default:`append`}},required:[`prompt`],additionalProperties:!1},async execute(e){let{handle:t,elements:n}=wr(),r=(e?.prompt??``).trim(),i=e?.mode===`replace`?`replace`:`append`;if(!r)throw Error(N(`excalidraw.tools.promptRequired`));let a=await ye.generateDiagram(r),o=i===`append`?[...n,...a]:[...a];return t.updateScene({elements:o}),{insertedCount:a.length,mode:i}}},Fr={name:`excalidraw_ai_append_diagram`,description:N(`excalidraw.tools.aiAppendDiagramDescription`),parameters:{type:`object`,properties:{prompt:{type:`string`,description:N(`excalidraw.tools.aiAppendDiagramPromptDescription`)}},required:[`prompt`],additionalProperties:!1},async execute(e){let{handle:t,elements:n}=wr(),r=(e?.prompt??``).trim();if(!r)throw Error(N(`excalidraw.tools.promptRequired`));let i=await ye.generateDiagram(r),a=[...n,...i];return t.updateScene({elements:a}),{insertedCount:i.length}}},Ir={name:`excalidraw_create_diagram`,description:N(`excalidraw.tools.createDiagramDescription`),parameters:{type:`object`,properties:{elements:{type:`array`,description:N(`excalidraw.tools.createDiagramElementsDescription`),items:{type:`object`}},mode:{type:`string`,enum:[`append`,`replace`],description:N(`excalidraw.tools.createDiagramModeDescription`),default:`append`}},required:[`elements`],additionalProperties:!1},async execute(e){let{handle:t,elements:n}=wr(),r=e?.elements??[],i=e?.mode===`replace`?`replace`:`append`;if(!Array.isArray(r)||r.length===0)throw Error(N(`excalidraw.tools.elementsRequired`));let a=ve(r),o=i===`append`?[...n,...a]:[...a];return t.updateScene({elements:o}),{insertedCount:a.length,mode:i}}},Lr={name:`excalidraw_append_diagram`,description:N(`excalidraw.tools.appendDiagramDescription`),parameters:{type:`object`,properties:{elements:{type:`array`,description:N(`excalidraw.tools.appendDiagramElementsDescription`),items:{type:`object`}}},required:[`elements`],additionalProperties:!1},async execute(e){let{handle:t,elements:n}=wr(),r=e?.elements??[];if(!Array.isArray(r)||r.length===0)throw Error(N(`excalidraw.tools.elementsRequired`));let i=ve(r),a=[...n,...i];return t.updateScene({elements:a}),{insertedCount:i.length}}},Rr={name:`excalidraw_modify`,description:N(`excalidraw.tools.applyOperationsDescription`),parameters:{type:`object`,properties:{operations:{type:`array`,description:N(`excalidraw.tools.applyOperationsOperationsDescription`),items:{type:`object`,properties:{op:{type:`string`,enum:[`add_node`,`connect`,`rename_node`,`delete_node`],description:N(`excalidraw.tools.applyOperationsOpDescription`)},id:{type:`string`,description:N(`excalidraw.tools.applyOperationsIdDescription`)},label:{type:`string`,description:N(`excalidraw.tools.applyOperationsLabelDescription`)},kind:{type:`string`,description:N(`excalidraw.tools.applyOperationsKindDescription`)},near:{type:`string`,description:N(`excalidraw.tools.applyOperationsNearDescription`)},from:{type:`string`,description:N(`excalidraw.tools.applyOperationsFromDescription`)},to:{type:`string`,description:N(`excalidraw.tools.applyOperationsToDescription`)},target:{type:`string`,description:N(`excalidraw.tools.applyOperationsTargetDescription`)},newLabel:{type:`string`,description:N(`excalidraw.tools.applyOperationsNewLabelDescription`)}},required:[`op`],additionalProperties:!1}}},required:[`operations`],additionalProperties:!1},async execute(e){let{handle:t,elements:n}=wr(),r=e?.operations??[];if(!r.length)throw Error(N(`excalidraw.tools.operationsRequired`));let i=[...n],a=[],o=0,s=Ar(i),c=s?{x:(s.minX+s.maxX)/2,y:(s.minY+s.maxY)/2}:{x:0,y:0},l=(e,t,n)=>{a.push({index:e,op:t.op,reason:n})};return r.forEach((e,t)=>{if(!e||typeof e.op!=`string`){l(t,{op:`add_node`},N(`excalidraw.tools.invalidOperation`));return}if(e.op===`add_node`){let n=(e.label??``).trim();if(!n){l(t,e,N(`excalidraw.tools.addNodeLabelRequired`));return}let r=e.id&&e.id.trim()||`node-${Date.now()}-${t}-${Math.floor(Math.random()*1e4)}`,a=c;if(e.near){let t=kr(i,e.near);if(t){let e=Er(t);a={x:e.x+220,y:e.y}}}else s&&(a={x:s.maxX+220,y:c.y});let u=jr({baseId:r,label:n,center:a});i=[...i,...u],o+=1;return}if(e.op===`connect`){let n=(e.from??``).trim(),r=(e.to??``).trim();if(!n||!r){l(t,e,N(`excalidraw.tools.connectFromToRequired`));return}let a=kr(i,n),s=kr(i,r);if(!a||!s){l(t,e,N(`excalidraw.tools.connectNodeNotFound`));return}let c=Mr(a,s);i=[...i,c],o+=1;return}if(e.op===`rename_node`){let n=(e.target??``).trim(),r=(e.newLabel??``).trim();if(!n||!r){l(t,e,N(`excalidraw.tools.renameTargetLabelRequired`));return}let a=kr(i,n);if(!a){l(t,e,N(`excalidraw.tools.renameNodeNotFound`));return}let s=a;s.type===`text`?(s.text=r,s.originalText=r,s.updated=Date.now(),o+=1):l(t,e,N(`excalidraw.tools.renameOnlyTextNode`));return}if(e.op===`delete_node`){let n=(e.target??``).trim();if(!n){l(t,e,N(`excalidraw.tools.deleteTargetRequired`));return}let r=kr(i,n);if(!r){l(t,e,N(`excalidraw.tools.deleteNodeNotFound`));return}let a=new Set;a.add(r.id);let s=r;s.type===`text`&&typeof s.containerId==`string`&&a.add(s.containerId),i=i.filter(e=>!a.has(e.id)),o+=1;return}l(t,e,N(`excalidraw.tools.unknownOperationType`,{type:e.op}))}),t.updateScene({elements:i}),{applied:o,failed:a}}},zr=new class{async generateDiagram(e){let t=`根据以下描述生成 Draw.io XML 格式的图表：${e}

只返回有效的 Draw.io XML，不要包含任何其他文字或说明。`;try{let e=(await ue.chat({model:`dashscope/qwen3-max`,messages:[{role:`system`,content:`你是一个专业的 Draw.io 图表生成助手。根据用户描述生成 Draw.io XML 格式的图表。

要求：
1. 理解用户描述，生成相应的图表（流程图、架构图、UML 图、系统图等）
2. 只返回有效的 Draw.io XML，不要包含其他文字
3. XML 必须符合 Draw.io 的格式规范
4. 使用合适的图形、连接线和布局

Draw.io XML 基本结构：
- 根元素：<mxfile>
- 包含 <diagram> 元素
- 使用 <mxGraphModel> 作为图表模型
- 使用 <mxCell> 元素表示图形和连接

常用图形类型：
- rectangle: 矩形
- ellipse: 椭圆
- rhombus: 菱形（用于判断）
- hexagon: 六边形
- cylinder: 圆柱体
- actor: 人形图标
- cloud: 云形

连接线：
- edge: 连接线，使用 source 和 target 属性连接两个图形

布局要求：
- 图形间距合理，避免重叠
- 使用合适的颜色和样式
- 坐标从 (100, 100) 开始

示例 XML 结构：
<mxfile>
  <diagram>
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="2" value="开始" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="100" y="100" width="120" height="60" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>`},{role:`user`,content:t}]})).messages[0]?.content||``;if(!e.trim())throw Error(`AI 返回的内容为空`);let n=e.trim();if(n.startsWith("```xml")?n=n.replace(/^```xml\s*/m,``).replace(/\s*```$/m,``):n.startsWith("```")&&(n=n.replace(/^```\s*/m,``).replace(/\s*```$/m,``)),n=n.trim(),!n)throw Error(`AI 返回的内容格式不正确`);if(!n.includes(`<mxfile>`)||!n.includes(`</mxfile>`))throw Error(`AI 返回的内容不是有效的 Draw.io XML 格式`);return n}catch(e){throw console.error(`Error generating Draw.io diagram:`,e),Error(e instanceof Error?e.message:`生成图表时出错，请重试`)}}},Br={name:`drawio_generate_diagram`,description:N(`drawio.tools.generateDiagramDescription`),parameters:{type:`object`,properties:{prompt:{type:`string`,description:N(`drawio.tools.generateDiagramPromptDescription`)},mode:{type:`string`,enum:[`append`,`replace`],description:N(`drawio.tools.generateDiagramModeDescription`),default:`append`}},required:[`prompt`],additionalProperties:!1},async execute(e){let t=se();if(!t)throw Error(N(`drawio.tools.noCanvas`));let n=(e?.prompt??``).trim(),r=e?.mode===`replace`?`replace`:`append`;if(!n)throw Error(N(`drawio.tools.promptRequired`));let i=await zr.generateDiagram(n);if(r===`replace`)t.updateXml(i);else{let e=t.getXml();if(e&&e.trim()){let n=await Vr(e,i);t.updateXml(n)}else t.updateXml(i)}return{success:!0,mode:r}}};async function Vr(e,t){try{let n=new DOMParser,r=n.parseFromString(e,`text/xml`),i=n.parseFromString(t,`text/xml`),a=r.querySelector(`mxfile`),o=i.querySelector(`mxfile`);return!a||!o?t:(a.querySelectorAll(`diagram`),o.querySelectorAll(`diagram`).forEach((e,t)=>{let n=e.cloneNode(!0);n.setAttribute(`id`,`diagram-${Date.now()}-${t}`),a.appendChild(n)}),new XMLSerializer().serializeToString(r))}catch(e){return console.error(`Failed to merge Draw.io XML:`,e),t}}const Hr=[vr,xr,Sr,Cr,Nr,Pr,Fr,Ir,Lr,Rr,Br,{name:`drawio_analyze`,description:N(`drawio.tools.analyzeDescription`),parameters:{type:`object`,properties:{},additionalProperties:!1},async execute(){let e=se();if(!e)throw Error(N(`drawio.tools.noCanvas`));let t=e.getXml();if(!t||!t.trim())throw Error(N(`drawio.tools.emptyCanvas`));try{let e=new DOMParser().parseFromString(t,`text/xml`),n=[],r=[];e.querySelectorAll(`mxCell`).forEach(e=>{let t=e.getAttribute(`id`)||``,i=e.getAttribute(`value`)||``,a=e.getAttribute(`style`)||``,o=e.getAttribute(`vertex`),s=e.getAttribute(`edge`),c=e.getAttribute(`source`),l=e.getAttribute(`target`);if(o===`1`&&i){let e=`rectangle`;a.includes(`ellipse`)?e=`ellipse`:a.includes(`rhombus`)?e=`rhombus`:a.includes(`hexagon`)?e=`hexagon`:a.includes(`cylinder`)?e=`cylinder`:a.includes(`actor`)?e=`actor`:a.includes(`cloud`)&&(e=`cloud`),n.push({id:t,label:i,type:e})}s===`1`&&c&&l&&r.push({id:t,from:c,to:l})});let i=`图表包含 ${n.length} 个节点和 ${r.length} 条连接线。`;return{nodeCount:n.length,edgeCount:r.length,nodes:n,edges:r,summary:i}}catch(e){throw console.error(`Failed to analyze Draw.io XML:`,e),Error(N(`drawio.tools.analysisFailed`))}}}];var Ur=({content:e,isGenerating:t})=>{let{t:n}=he(),[r,i]=(0,I.useState)(!1);return t?null:(0,Z.jsx)(`button`,{onClick:async()=>{await navigator.clipboard.writeText(e),i(!0),setTimeout(()=>i(!1),2e3)},className:`p-1.5 text-muted-foreground/60 hover:text-foreground transition-colors rounded-md hover:bg-muted/50`,title:n(`globalChat.copyContent`),children:r?(0,Z.jsx)(oe,{className:`h-3.5 w-3.5`}):(0,Z.jsx)(g,{className:`h-3.5 w-3.5`})})};const Wr=()=>{let{t:e}=he(),[t,n]=(0,I.useState)(``),i=(0,I.useRef)(null),{colorMode:a}=r(),{containerRef:o,notifyNewItem:s,scrollToBottom:c}=re();ne(ke());let l=ie(e=>e.contexts).map(e=>({description:e.description,value:e.value})),{toolDefs:u,toolExecutors:d}=hr((0,I.useMemo)(()=>Hr,[])),{messages:f,isAgentResponding:p,sendMessage:m,abortAgentRun:h}=it({agent:ze,toolDefs:u,toolExecutors:d,contexts:l,initialMessages:[]}),g=e=>(e.parts||[]).filter(e=>e.type===`text`).map(e=>e.type===`text`?e.text:``).join(`

`),_=f,y=(0,I.useMemo)(()=>[...f].reverse().find(e=>e.role===`assistant`)?.id,[f]);(0,I.useEffect)(()=>{s()},[_,s]);let b=e=>{n(e.target.value);let t=e.target;t.style.height=`40px`;let r=Math.min(Math.max(t.scrollHeight,40),200);t.style.height=`${r}px`},S=async()=>{if(p){h();return}if(!t.trim())return;let e=t.trim();n(``),i.current&&(i.current.style.height=`40px`);try{await m(e)}catch(e){console.error(`Global AI assistant error:`,e)}};return(0,Z.jsxs)(`div`,{className:`flex h-full flex-col overflow-hidden bg-background`,children:[(0,Z.jsx)(`div`,{className:`flex-1 overflow-y-auto overflow-x-hidden scroll-smooth`,ref:o,children:(0,Z.jsxs)(`div`,{className:`max-w-3xl mx-auto w-full`,children:[_.length===0&&(0,Z.jsxs)(`div`,{className:`flex flex-col items-center justify-center min-h-[60vh] text-center px-6 animate-in fade-in duration-500`,children:[(0,Z.jsx)(`div`,{className:`w-16 h-16 mb-6`,children:(0,Z.jsx)(ce,{className:`w-full h-full`})}),(0,Z.jsx)(`h3`,{className:`text-2xl font-semibold text-foreground mb-3 tracking-tight`,children:e(`globalChat.welcomeTitle`)||`How can I help you today?`}),(0,Z.jsx)(`p`,{className:`text-base text-muted-foreground max-w-md leading-relaxed`,children:e(`globalChat.welcomeDesc`)||`I'm your global AI assistant. Whether it's code problems, creative writing, or everyday chat, I'm happy to help.`})]}),(0,Z.jsx)(`div`,{className:`py-4 space-y-6`,children:_.filter(e=>e.role===`user`||e.role===`assistant`).map(e=>{let t=g(e),n=t.trim().length>0,r=e.role===`assistant`,i=(e.parts||[]).some(e=>e.type===`tool-invocation`),o=r&&e.id===y;return(0,Z.jsx)(`div`,{className:`w-full group animate-in slide-in-from-bottom-2 duration-300`,children:r?(0,Z.jsx)(`div`,{className:`flex flex-col gap-1.5`,children:(0,Z.jsxs)(`div`,{className:`px-4 group/content relative`,children:[o&&p&&!n&&!i?(0,Z.jsxs)(`div`,{className:`flex items-center gap-2 text-muted-foreground h-7`,children:[(0,Z.jsx)(`span`,{className:`w-1.5 h-1.5 bg-violet-500/40 rounded-full animate-bounce [animation-delay:-0.3s]`}),(0,Z.jsx)(`span`,{className:`w-1.5 h-1.5 bg-violet-500/40 rounded-full animate-bounce [animation-delay:-0.15s]`}),(0,Z.jsx)(`span`,{className:`w-1.5 h-1.5 bg-violet-500/40 rounded-full animate-bounce`})]}):n?(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(pe,{content:t,isDark:a===`dark`}),(0,Z.jsx)(`div`,{className:`mt-2 opacity-0 group-hover/content:opacity-100 transition-opacity`,children:(0,Z.jsx)(Ur,{content:t,isGenerating:p&&o})})]}):null,(0,Z.jsx)(gr,{message:e})]})}):(0,Z.jsx)(`div`,{className:`flex flex-col gap-1.5 items-end`,children:(0,Z.jsx)(`div`,{className:`px-4 w-full flex justify-end`,children:(0,Z.jsx)(`div`,{className:`bg-secondary/80 text-secondary-foreground px-4 py-2.5 rounded-[20px] rounded-tr-md shadow-sm max-w-full inline-block border border-border/5`,children:(0,Z.jsx)(`div`,{className:`text-[15px] leading-relaxed whitespace-pre-wrap break-words`,children:t})})})})},e.id)})})]})}),(0,Z.jsx)(`div`,{className:`flex-shrink-0 border-t border-border bg-background z-10`,children:(0,Z.jsxs)(`div`,{className:`max-w-3xl mx-auto w-full p-4`,children:[(0,Z.jsxs)(`div`,{className:`relative flex items-end gap-2 rounded-[26px] bg-background border border-border p-2`,children:[(0,Z.jsx)(ae,{ref:i,value:t,onChange:b,onKeyDown:e=>{e.key===`Enter`&&!e.shiftKey&&(e.preventDefault(),S(),c())},placeholder:e(`globalChat.placeholder`)||`输入消息...`,className:`flex-1 resize-none border-0 bg-transparent focus-visible:ring-0 focus-visible:ring-offset-0 px-3 py-2.5 text-[15px] placeholder:text-muted-foreground/50 overflow-y-auto`,style:{height:`40px`,minHeight:`40px`,maxHeight:`200px`},rows:1}),(0,Z.jsx)(v,{onClick:S,disabled:!t.trim()&&!p,size:`icon`,className:x(`h-8 w-8 rounded-full transition-all duration-200 flex-shrink-0 mb-0.5 mr-0.5`,t.trim()?`bg-gradient-to-br from-violet-500 to-purple-500 text-white hover:from-violet-600 hover:to-purple-600 shadow-sm`:`bg-muted text-muted-foreground hover:bg-muted/80`),children:p?(0,Z.jsx)(Ee,{className:`h-4 w-4`}):(0,Z.jsx)(Te,{className:`h-5 w-5`})})]}),(0,Z.jsx)(`p`,{className:`text-[10px] text-muted-foreground/40 text-center mt-2 font-medium tracking-wide uppercase`,children:e(`globalChat.disclaimer`)||`AI can make mistakes. Check important info.`})]})})]})};export{Wr as GlobalChatPanel};