import{t as e}from"./rolldown-runtime-B6ubh40S.js";import"./chakra-ui-DL3iEWi3.js";import"./excalidraw-BZQshQpt.js";import{t}from"./common-utils-BE1DbrSU.js";import{D as n}from"./mermaid-b5860b54-BPl11UBk.js";const r={rect:`rectangle`,circle:`ellipse`},i={startOnLoad:!1,flowchart:{curve:`linear`},themeVariables:{fontSize:`${20*1.25}px`},maxEdges:500,maxTextSize:5e4};var a=class{constructor({converter:e}){this.convert=(e,t)=>this.converter(e,{...t,fontSize:t.fontSize||20}),this.converter=e}},o;(function(e){e.ROUND=`round`,e.STADIUM=`stadium`,e.DOUBLECIRCLE=`doublecircle`,e.CIRCLE=`circle`,e.DIAMOND=`diamond`})(o||={});var s;(function(e){e.COLOR=`color`})(s||={});var c;(function(e){e.FILL=`fill`,e.STROKE=`stroke`,e.STROKE_WIDTH=`stroke-width`,e.STROKE_DASHARRAY=`stroke-dasharray`})(c||={});var l=e((e=>{Object.defineProperty(e,`__esModule`,{value:!0}),e.removeMarkdown=void 0,e.removeMarkdown=function(e,t){t===void 0&&(t={listUnicodeChar:``}),t||={},t.listUnicodeChar=t.hasOwnProperty(`listUnicodeChar`)?t.listUnicodeChar:!1,t.stripListLeaders=t.hasOwnProperty(`stripListLeaders`)?t.stripListLeaders:!0,t.gfm=t.hasOwnProperty(`gfm`)?t.gfm:!0,t.useImgAltText=t.hasOwnProperty(`useImgAltText`)?t.useImgAltText:!0,t.preserveLinks=t.hasOwnProperty(`preserveLinks`)?t.preserveLinks:!1;var n=e||``;n=n.replace(/^(-\s*?|\*\s*?|_\s*?){3,}\s*$/gm,``);try{t.stripListLeaders&&(n=t.listUnicodeChar?n.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,t.listUnicodeChar+` $1`):n.replace(/^([\s\t]*)([\*\-\+]|\d+\.)\s+/gm,`$1`)),t.gfm&&(n=n.replace(/\n={2,}/g,`
`).replace(/~{3}.*\n/g,``).replace(/~~/g,``).replace(/`{3}.*\n/g,``)),t.preserveLinks&&(n=n.replace(/\[(.*?)\][\[\(](.*?)[\]\)]/g,`$1 ($2)`)),n=n.replace(/<[^>]*>/g,``).replace(/^[=\-]{2,}\s*$/g,``).replace(/\[\^.+?\](\: .*?$)?/g,``).replace(/\s{0,2}\[.*?\]: .*?$/g,``).replace(/\!\[(.*?)\][\[\(].*?[\]\)]/g,t.useImgAltText?`$1`:``).replace(/\[(.*?)\][\[\(].*?[\]\)]/g,`$1`).replace(/^\s{0,3}>\s?/g,``).replace(/(^|\n)\s{0,3}>\s?/g,`

`).replace(/^\s{1,2}\[(.*?)\]: (\S+)( ".*?")?\s*$/g,``).replace(/^(\n)?\s{0,}#{1,6}\s+| {0,}(\n)?\s{0,}#{0,} {0,}(\n)?\s{0,}$/gm,`$1$2$3`).replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,`$2`).replace(/([\*_]{1,3})(\S.*?\S{0,1})\1/g,`$2`).replace(/(`{3,})(.*?)\1/gm,`$2`).replace(/`(.+?)`/g,`$1`).replace(/\n{2,}/g,`

`)}catch(t){return console.error(t),e}return n}}))(),u={arrow_circle:{endArrowhead:`dot`},arrow_cross:{endArrowhead:`bar`},arrow_open:{endArrowhead:null,startArrowhead:null},double_arrow_circle:{endArrowhead:`dot`,startArrowhead:`dot`},double_arrow_cross:{endArrowhead:`bar`,startArrowhead:`bar`},double_arrow_point:{endArrowhead:`arrow`,startArrowhead:`arrow`}};const d=e=>u[e],f=e=>{let t=e.text;return e.labelType===`markdown`&&(t=(0,l.removeMarkdown)(e.text)),p(t)};var p=e=>e.replace(/\s?(fa|fab):[a-zA-Z0-9-]+/g,``);const m=e=>{let t={};return Object.keys(e).forEach(n=>{switch(n){case c.FILL:t.backgroundColor=e[n],t.fillStyle=`solid`;break;case c.STROKE:t.strokeColor=e[n];break;case c.STROKE_WIDTH:t.strokeWidth=Number(e[n]?.split(`px`)[0]);break;case c.STROKE_DASHARRAY:t.strokeStyle=`dashed`;break}}),t},h=e=>{let t={};return Object.keys(e).forEach(n=>{switch(n){case s.COLOR:t.strokeColor=e[n];break}}),t};var g=e=>{let t={};e.subGraphs.map(n=>{n.nodeIds.forEach(r=>{t[n.id]={id:n.id,parent:null,isLeaf:!1},t[r]={id:r,parent:n.id,isLeaf:e.vertices[r]!==void 0}})});let n={};return[...Object.keys(e.vertices),...e.subGraphs.map(e=>e.id)].forEach(e=>{if(!t[e])return;let r=t[e],i=[];for(r.isLeaf||i.push(`subgraph_group_${r.id}`);r.parent;)i.push(`subgraph_group_${r.parent}`),r=t[r.parent];n[e]=i}),{getGroupIds:e=>n[e]||[],getParentId:e=>t[e]?t[e].parent:null}};const _=new a({converter:(e,t)=>{let n=[],r=t.fontSize,{getGroupIds:i,getParentId:a}=g(e);return e.subGraphs.reverse().forEach(e=>{let t=i(e.id),a={id:e.id,type:`rectangle`,groupIds:t,x:e.x,y:e.y,width:e.width,height:e.height,label:{groupIds:t,text:f(e),fontSize:r,verticalAlign:`top`}};n.push(a)}),Object.values(e.vertices).forEach(e=>{if(!e)return;let t=i(e.id),a=m(e.containerStyle),s=h(e.labelStyle),c={id:e.id,type:`rectangle`,groupIds:t,x:e.x,y:e.y,width:e.width,height:e.height,strokeWidth:2,label:{groupIds:t,text:f(e),fontSize:r,...s},link:e.link||null,...a};switch(e.type){case o.STADIUM:c={...c,roundness:{type:3}};break;case o.ROUND:c={...c,roundness:{type:3}};break;case o.DOUBLECIRCLE:{t.push(`doublecircle_${e.id}}`);let i={type:`ellipse`,groupIds:t,x:e.x+5,y:e.y+5,width:e.width-10,height:e.height-10,strokeWidth:2,roundness:{type:3},label:{groupIds:t,text:f(e),fontSize:r}};c={...c,groupIds:t,type:`ellipse`},n.push(i);break}case o.CIRCLE:c.type=`ellipse`;break;case o.DIAMOND:c.type=`diamond`;break}n.push(c)}),e.edges.forEach(e=>{let t=[],o=a(e.start),s=a(e.end);o&&o===s&&(t=i(o));let{startX:c,startY:l,reflectionPoints:u}=e,p=u.map(e=>[e.x-u[0].x,e.y-u[0].y]),m=d(e.type),h={id:`${e.start}_${e.end}`,type:`arrow`,groupIds:t,x:c,y:l,strokeWidth:e.stroke===`thick`?4:2,strokeStyle:e.stroke===`dotted`?`dashed`:void 0,points:p,...e.text?{label:{text:f(e),fontSize:r,groupIds:t}}:{},roundness:{type:2},...m},g=n.find(t=>t.id===e.start),_=n.find(t=>t.id===e.end);!g||!_||(h.start={id:g.id||``},h.end={id:_.id||``},n.push(h))}),{elements:n}}}),v=new a({converter:e=>{let n=t(),{width:r,height:i}=e,a={type:`image`,x:0,y:0,width:r,height:i,status:`saved`,fileId:n};return{files:{[n]:{id:n,mimeType:e.mimeType,dataURL:e.dataURL}},elements:[a]}}}),y=e=>e.replace(/\\n/g,`
`),b=e=>{let t={type:`line`,x:e.startX,y:e.startY,points:[[0,0],[e.endX-e.startX,e.endY-e.startY]],width:e.endX-e.startX,height:e.endY-e.startY,strokeStyle:e.strokeStyle||`solid`,strokeColor:e.strokeColor||`#000`,strokeWidth:e.strokeWidth||1};return e.groupId&&Object.assign(t,{groupIds:[e.groupId]}),e.id&&Object.assign(t,{id:e.id}),t},x=e=>{let t={type:`text`,x:e.x,y:e.y,width:e.width,height:e.height,text:y(e.text)||``,fontSize:e.fontSize,verticalAlign:`middle`};return e.groupId&&Object.assign(t,{groupIds:[e.groupId]}),e.id&&Object.assign(t,{id:e.id}),t},S=e=>{let t={};e.type===`rectangle`&&e.subtype===`activation`&&(t={backgroundColor:`#e9ecef`,fillStyle:`solid`});let n={id:e.id,type:e.type,x:e.x,y:e.y,width:e.width,height:e.height,label:{text:y(e?.label?.text||``),fontSize:e?.label?.fontSize,verticalAlign:e.label?.verticalAlign||`middle`,strokeColor:e.label?.color||`#000`,groupIds:e.groupId?[e.groupId]:[]},strokeStyle:e?.strokeStyle,strokeWidth:e?.strokeWidth,strokeColor:e?.strokeColor,backgroundColor:e?.bgColor,fillStyle:`solid`,...t};return e.groupId&&Object.assign(n,{groupIds:[e.groupId]}),n},C=e=>{let t={type:`arrow`,x:e.startX,y:e.startY,points:e.points||[[0,0],[e.endX-e.startX,e.endY-e.startY]],width:e.endX-e.startX,height:e.endY-e.startY,strokeStyle:e?.strokeStyle||`solid`,endArrowhead:e?.endArrowhead||null,startArrowhead:e?.startArrowhead||null,label:{text:y(e?.label?.text||``),fontSize:16},roundness:{type:2},start:e.start,end:e.end};return e.groupId&&Object.assign(t,{groupIds:[e.groupId]}),t},w=new a({converter:e=>{let n=[],r=[];if(Object.values(e.nodes).forEach(e=>{!e||!e.length||e.forEach(e=>{let t;switch(e.type){case`line`:t=b(e);break;case`rectangle`:case`ellipse`:t=S(e);break;case`text`:t=x(e);break;default:throw`unknown type ${e.type}`}e.type===`rectangle`&&e?.subtype===`activation`?r.push(t):n.push(t)})}),Object.values(e.lines).forEach(e=>{e&&n.push(b(e))}),Object.values(e.arrows).forEach(e=>{e&&(n.push(C(e)),e.sequenceNumber&&n.push(S(e.sequenceNumber)))}),n.push(...r),e.loops){let{lines:t,texts:r,nodes:i}=e.loops;t.forEach(e=>{n.push(b(e))}),r.forEach(e=>{n.push(x(e))}),i.forEach(e=>{n.push(S(e))})}return e.groups&&e.groups.forEach(e=>{let{actorKeys:r,name:i}=e,a=1/0,o=1/0,s=0,c=0;if(!r.length)return;n.filter(e=>{if(e.id){let t=e.id.indexOf(`-`),n=e.id.substring(0,t);return r.includes(n)}}).forEach(e=>{if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw Error(`Actor attributes missing ${e}`);a=Math.min(a,e.x),o=Math.min(o,e.y),s=Math.max(s,e.x+e.width),c=Math.max(c,e.y+e.height)});let l=a-10,u=o-10,d=s-a+20,f=c-o+20,p=t(),m=S({type:`rectangle`,x:l,y:u,width:d,height:f,bgColor:e.fill,id:p});n.unshift(m);let h=t(),g=[p];n.forEach(e=>{if(e.type!==`frame`){if(e.x===void 0||e.y===void 0||e.width===void 0||e.height===void 0)throw Error(`Element attributes missing ${e}`);if(e.x>=a&&e.x+e.width<=s&&e.y>=o&&e.y+e.height<=c){let n=e.id||t();e.id||Object.assign(e,{id:n}),g.push(n)}}});let _={type:`frame`,id:h,name:i,children:g};n.push(_)}),{elements:n}}}),ee=new a({converter:e=>{let n=[];return Object.values(e.nodes).forEach(e=>{!e||!e.length||e.forEach(e=>{let t;switch(e.type){case`line`:t=b(e);break;case`rectangle`:case`ellipse`:t=S(e);break;case`text`:t=x(e);break;default:throw`unknown type ${e.type}`}n.push(t)})}),Object.values(e.lines).forEach(e=>{e&&n.push(b(e))}),Object.values(e.arrows).forEach(e=>{if(!e)return;let t=C(e);n.push(t)}),Object.values(e.text).forEach(e=>{let t=x(e);n.push(t)}),Object.values(e.namespaces).forEach(r=>{let i=Object.keys(r.classes),a=[...i],o=[...e.lines,...e.arrows,...e.text];i.forEach(e=>{let t=o.filter(t=>t.metadata&&t.metadata.classId===e).map(e=>e.id);t.length&&a.push(...t)});let s={type:`frame`,id:t(),name:r.id,children:a};n.push(s)}),{elements:n}}}),T=(e,t={})=>{switch(e.type){case`graphImage`:return v.convert(e,t);case`flowchart`:return _.convert(e,t);case`sequence`:return w.convert(e,t);case`class`:return ee.convert(e,t);default:throw Error(`graphToExcalidraw: unknown graph type "${e.type}, only flowcharts are supported!"`)}},E=e=>{e=ne(e);let t=e.replace(/#(\d+);/g,`&#$1;`).replace(/#([a-z]+);/g,`&$1;`),n=document.createElement(`textarea`);return n.innerHTML=t,n.value},D=e=>{let t=e.getAttribute(`transform`)?.match(/translate\(([ \d.-]+),\s*([\d.-]+)\)/),n=0,r=0;return t&&(n=Number(t[1]),r=Number(t[2])),{transformX:n,transformY:r}},te=e=>{let t=e;return t=t.replace(/style.*:\S*#.*;/g,e=>e.substring(0,e.length-1)),t=t.replace(/classDef.*:\S*#.*;/g,e=>e.substring(0,e.length-1)),t=t.replace(/#\w+;/g,e=>{let t=e.substring(1,e.length-1);return/^\+?\d+$/.test(t)?`ﬂ°°${t}¶ß`:`ﬂ°${t}¶ß`}),t},ne=function(e){return e.replace(/ﬂ°°/g,`#`).replace(/ﬂ°/g,`&`).replace(/¶ß/g,`;`)},O=(e,t={x:0,y:0})=>{if(e.tagName.toLowerCase()!==`path`)throw Error(`Invalid input: Expected an HTMLElement of tag "path", got ${e.tagName}`);let n=e.getAttribute(`d`);if(!n)throw Error(`Path element does not contain a "d" attribute`);let r=n.split(/(?=[LM])/),i=r[0].substring(1).split(`,`).map(e=>parseFloat(e)),a=r[r.length-1].substring(1).split(`,`).map(e=>parseFloat(e)),o=r.map(e=>{let t=e.substring(1).split(`,`).map(e=>parseFloat(e));return{x:t[0],y:t[1]}}).filter((e,t,n)=>{if(t===0||t===n.length-1)return!0;if(e.x===n[t-1].x&&e.y===n[t-1].y)return!1;if(t===n.length-2&&(n[t-1].x===e.x||n[t-1].y===e.y)){let t=n[n.length-1];return Math.hypot(t.x-e.x,t.y-e.y)>20}return e.x!==n[t-1].x||e.y!==n[t-1].y}).map(e=>({x:e.x+t.x,y:e.y+t.y}));return{startX:i[0]+t.x,startY:i[1]+t.y,endX:a[0]+t.x,endY:a[1]+t.y,reflectionPoints:o}};var k=(e,t)=>{let n=e.nodes.map(e=>e.startsWith(`flowchart-`)?e.split(`-`)[1]:e),r=t.querySelector(`[id='${e.id}']`);if(!r)throw Error(`SubGraph element not found`);let i=M(r,t),a=r.getBBox(),o={width:a.width,height:a.height};return e.classes=void 0,e.dir=void 0,{...e,nodeIds:n,...i,...o,text:E(e.title)}},A=(e,t)=>{let n=t.querySelector(`[id*="flowchart-${e.id}-"]`);if(!n)return;let r;n.parentElement?.tagName.toLowerCase()===`a`&&(r=n.parentElement.getAttribute(`xlink:href`));let i=M(r?n.parentElement:n,t),a=n.getBBox(),o={width:a.width,height:a.height},s=n.querySelector(`.label-container`)?.getAttribute(`style`),c=n.querySelector(`.label`)?.getAttribute(`style`),l={};s?.split(`;`).forEach(e=>{if(!e)return;let t=e.split(`:`)[0].trim();l[t]=e.split(`:`)[1].trim()});let u={};return c?.split(`;`).forEach(e=>{if(!e)return;let t=e.split(`:`)[0].trim();u[t]=e.split(`:`)[1].trim()}),{id:e.id,labelType:e.labelType,text:E(e.text),type:e.type,link:r||void 0,...i,...o,containerStyle:l,labelStyle:u}},j=(e,t,n)=>{let r=n.querySelector(`[id*="L-${e.start}-${e.end}-${t}"]`);if(!r)throw Error(`Edge element not found`);let i=O(r,M(r,n));return e.length=void 0,{...e,...i,text:E(e.text)}},M=(e,t)=>{if(!e)throw Error(`Element not found`);let n=e.parentElement?.parentElement,r=e.childNodes[0],i={x:0,y:0};if(r){let{transformX:e,transformY:t}=D(r),n=r.getBBox();i={x:Number(r.getAttribute(`x`))||e+n.x||0,y:Number(r.getAttribute(`y`))||t+n.y||0}}let{transformX:a,transformY:o}=D(e),s={x:a+i.x,y:o+i.y};for(;n&&n.id!==t.id;){if(n.classList.value===`root`&&n.hasAttribute(`transform`)){let{transformX:e,transformY:t}=D(n);s.x+=e,s.y+=t}n=n.parentElement}return s};const re=(e,t)=>{e.parse();let n=e.parser.yy,r=n.getVertices();Object.keys(r).forEach(e=>{r[e]=A(r[e],t)});let i=new Map,a=n.getEdges().filter(e=>t.querySelector(`[id*="L-${e.start}-${e.end}"]`)).map(e=>{let n=`${e.start}-${e.end}`,r=i.get(n)||0;return i.set(n,r+1),j(e,r,t)});return{type:`flowchart`,subGraphs:n.getSubGraphs().map(e=>k(e,t)),vertices:r,edges:a}},ie=(e,t)=>{let n={};t?.label&&(n.label={text:E(t.label),fontSize:16});let r=e.tagName;if(r===`line`)n.startX=Number(e.getAttribute(`x1`)),n.startY=Number(e.getAttribute(`y1`)),n.endX=Number(e.getAttribute(`x2`)),n.endY=Number(e.getAttribute(`y2`));else if(r===`path`){let t=e.getAttribute(`d`);if(!t)throw Error(`Path element does not contain a "d" attribute`);let r=t.split(/(?=[LC])/),i=r[0].substring(1).split(`,`).map(e=>parseFloat(e)),a=[];r.forEach(e=>{let t=e.substring(1).trim().split(` `).map(e=>{let[t,n]=e.split(`,`);return[parseFloat(t)-i[0],parseFloat(n)-i[1]]});a.push(...t)});let o=a[a.length-1];n.startX=i[0],n.startY=i[1],n.endX=o[0],n.endY=o[1],n.points=a}return t?.label&&(n.startY-=10,n.endY-=10),n.strokeColor=e.getAttribute(`stroke`),n.strokeWidth=Number(e.getAttribute(`stroke-width`)),n.type=`arrow`,n.strokeStyle=t?.strokeStyle||`solid`,n.startArrowhead=t?.startArrowhead||null,n.endArrowhead=t?.endArrowhead||null,n},N=(e,t,n,r,i)=>{let a={};return a.type=`arrow`,a.startX=e,a.startY=t,a.endX=n,a.endY=r,Object.assign(a,{...i}),a},P=(e,t,n,r)=>({type:`text`,x:e,y:t,text:n,width:r?.width||20,height:r?.height||20,fontSize:r?.fontSize||20,id:r?.id,groupId:r?.groupId,metadata:r?.metadata}),F=(e,t,n)=>{let r={},i=Number(e.getAttribute(`x`)),a=Number(e.getAttribute(`y`));r.type=`text`,r.text=E(t),n?.id&&(r.id=n.id),n?.groupId&&(r.groupId=n.groupId);let o=e.getBBox();return r.width=o.width,r.height=o.height,r.x=i-o.width/2,r.y=a,r.fontSize=parseInt(getComputedStyle(e).fontSize),r},I=(e,t,n={})=>{let r={};r.type=t;let{label:i,subtype:a,id:o,groupId:s}=n;r.id=o,s&&(r.groupId=s),i&&(r.label={text:E(i.text),fontSize:16,verticalAlign:i?.verticalAlign});let c=e.getBBox();switch(r.x=c.x,r.y=c.y,r.width=c.width,r.height=c.height,r.subtype=a,a){case`highlight`:let t=e.getAttribute(`fill`);t&&(r.bgColor=t);break;case`note`:r.strokeStyle=`dashed`;break}return r},L=(e,t,n,r,i,a)=>{let o={};return o.startX=t,o.startY=n,o.endX=r,a?.groupId&&(o.groupId=a.groupId),a?.id&&(o.id=a.id),o.endY=i,o.strokeColor=e.getAttribute(`stroke`),o.strokeWidth=Number(e.getAttribute(`stroke-width`)),o.type=`line`,o};var R={0:`SOLID`,1:`DOTTED`,3:`SOLID_CROSS`,4:`DOTTED_CROSS`,5:`SOLID_OPEN`,6:`DOTTED_OPEN`,24:`SOLID_POINT`,25:`DOTTED_POINT`},z={SOLID:0,DOTTED:1,NOTE:2,SOLID_CROSS:3,DOTTED_CROSS:4,SOLID_OPEN:5,DOTTED_OPEN:6,LOOP_START:10,LOOP_END:11,ALT_START:12,ALT_ELSE:13,ALT_END:14,OPT_START:15,OPT_END:16,ACTIVE_START:17,ACTIVE_END:18,PAR_START:19,PAR_AND:20,PAR_END:21,RECT_START:22,RECT_END:23,SOLID_POINT:24,DOTTED_POINT:25,AUTONUMBER:26,CRITICAL_START:27,CRITICAL_OPTION:28,CRITICAL_END:29,BREAK_START:30,BREAK_END:31,PAR_OVER_START:32},B=e=>{let t;switch(e){case z.SOLID:case z.SOLID_CROSS:case z.SOLID_OPEN:case z.SOLID_POINT:t=`solid`;break;case z.DOTTED:case z.DOTTED_CROSS:case z.DOTTED_OPEN:case z.DOTTED_POINT:t=`dotted`;break;default:t=`solid`;break}return t},V=(e,t)=>{if(e.nextElementSibling?.classList.contains(`sequenceNumber`)){let n=e.nextElementSibling?.textContent;if(!n)throw Error(`sequence number not present`);let r={type:`rectangle`,x:t.startX-10,y:t.startY-15,label:{text:n,fontSize:14},bgColor:`#e9ecef`,height:30,subtype:`sequence`};Object.assign(t,{sequenceNumber:r})}},H=(e,n,i)=>{if(!e)throw`root node not found`;let a=t(),o=Array.from(e.children),s=[];return o.forEach((e,t)=>{let o=`${i?.id}-${t}`,c;switch(e.tagName){case`line`:c=L(e,Number(e.getAttribute(`x1`)),Number(e.getAttribute(`y1`)),Number(e.getAttribute(`x2`)),Number(e.getAttribute(`y2`)),{groupId:a,id:o});break;case`text`:c=F(e,n,{groupId:a,id:o});break;case`circle`:c=I(e,`ellipse`,{label:e.textContent?{text:e.textContent}:void 0,groupId:a,id:o});default:c=I(e,r[e.tagName],{label:e.textContent?{text:e.textContent}:void 0,groupId:a,id:o})}s.push(c)}),s},U=(e,t)=>{let n=Array.from(t.querySelectorAll(`.actor-top`)),r=Array.from(t.querySelectorAll(`.actor-bottom`)),i=[],a=[];return Object.values(e).forEach((e,t)=>{let o=n.find(t=>t.getAttribute(`name`)===e.name),s=r.find(t=>t.getAttribute(`name`)===e.name);if(!o||!s)throw`root not found`;let c=e.description;if(e.type===`participant`){let t=I(o,`rectangle`,{id:`${e.name}-top`,label:{text:c},subtype:`actor`});if(!t)throw`Top Node element not found!`;i.push([t]);let n=I(s,`rectangle`,{id:`${e.name}-bottom`,label:{text:c},subtype:`actor`});i.push([n]);let r=o?.parentElement?.previousElementSibling;if(r?.tagName!==`line`)throw`Line not found`;let l=Number(r.getAttribute(`x1`));if(!t.height)throw`Top node element height is null`;let u=t.y+t.height,d=n.y,f=L(r,l,u,Number(r.getAttribute(`x2`)),d);a.push(f)}else if(e.type===`actor`){let t=H(o,c,{id:`${e.name}-top`});i.push(t);let n=H(s,c,{id:`${e.name}-bottom`});i.push(n);let r=o.previousElementSibling;if(r?.tagName!==`line`)throw`Line not found`;let l=Number(r.getAttribute(`x1`)),u=Number(r.getAttribute(`y1`)),d=Number(r.getAttribute(`x2`)),f=n.find(e=>e.type===`ellipse`);if(f){let e=f.y,t=L(r,l,u,d,e);a.push(t)}}}),{nodes:i,lines:a}},W=(e,t)=>{let n=[],r=Array.from(t.querySelectorAll(`[class*="messageLine"]`)),i=Object.keys(R),a=e.filter(e=>i.includes(e.type.toString()));return r.forEach((e,t)=>{let r=a[t],i=R[r.type],o=ie(e,{label:r?.message,strokeStyle:B(r.type),endArrowhead:i===`SOLID_OPEN`||i===`DOTTED_OPEN`?null:`arrow`});V(e,o),n.push(o)}),n},G=(e,t)=>{let n=Array.from(t.querySelectorAll(`.note`)).map(e=>e.parentElement),r=e.filter(e=>e.type===z.NOTE),i=[];return n.forEach((e,t)=>{if(!e)return;let n=e.firstChild,a=r[t].message,o=I(n,`rectangle`,{label:{text:a},subtype:`note`});i.push(o)}),i},K=e=>{let t=Array.from(e.querySelectorAll(`[class*=activation]`)),n=[];return t.forEach(e=>{let t=I(e,`rectangle`,{label:{text:``},subtype:`activation`});n.push(t)}),n},q=(e,t)=>{let n=Array.from(t.querySelectorAll(`.loopLine`)),r=[],i=[],a=[];n.forEach(e=>{let t=L(e,Number(e.getAttribute(`x1`)),Number(e.getAttribute(`y1`)),Number(e.getAttribute(`x2`)),Number(e.getAttribute(`y2`)));t.strokeStyle=`dotted`,t.strokeColor=`#adb5bd`,t.strokeWidth=2,r.push(t)});let o=Array.from(t.querySelectorAll(`.loopText`)),s=e.filter(e=>e.type===z.CRITICAL_START).map(e=>e.message);o.forEach(e=>{let t=e.textContent||``,n=F(e,t),r=t.match(/\[(.*?)\]/)?.[1]||``;s.includes(r)&&(n.x+=16),i.push(n)});let c=Array.from(t?.querySelectorAll(`.labelBox`)),l=Array.from(t?.querySelectorAll(`.labelText`));return c.forEach((e,t)=>{let n=I(e,`rectangle`,{label:{text:l[t]?.textContent||``}});n.strokeColor=`#adb5bd`,n.bgColor=`#e9ecef`,n.width=void 0,a.push(n)}),{lines:r,texts:i,nodes:a}},J=e=>{let t=Array.from(e.querySelectorAll(`.rect`)).filter(e=>e.parentElement?.tagName!==`g`),n=[];return t.forEach(e=>{let t=I(e,`rectangle`,{label:{text:``},subtype:`highlight`});n.push(t)}),n};const ae=(e,t)=>{e.parse();let n=e.parser.yy,r=[],i=n.getBoxes(),a=J(t),{nodes:o,lines:s}=U(n.getActors(),t),c=n.getMessages(),l=W(c,t),u=G(c,t),d=K(t),f=q(c,t);return r.push(a),r.push(...o),r.push(u),r.push(d),{type:`sequence`,lines:s,arrows:l,nodes:r,loops:f,groups:i}};var Y={AGGREGATION:0,EXTENSION:1,COMPOSITION:2,DEPENDENCY:3,LOLLIPOP:4},X={LINE:0,DOTTED_LINE:1},Z=16,oe=e=>{let t;switch(e){case X.LINE:t=`solid`;break;case X.DOTTED_LINE:t=`dotted`;break;default:t=`solid`}return t},Q=e=>{let t;switch(e){case Y.AGGREGATION:t=`diamond_outline`;break;case Y.COMPOSITION:t=`diamond`;break;case Y.EXTENSION:t=`triangle_outline`;break;case`none`:t=null;break;case Y.DEPENDENCY:default:t=`arrow`;break}return t},se=(e,n)=>{let r=[],i=[],a=[];return Object.values(e).forEach(e=>{let{domId:o,id:s}=e,c=t(),l=n.querySelector(`[data-id=${s}]`);if(!l)throw Error(`DOM Node with id ${o} not found`);let{transformX:u,transformY:d}=D(l),f=I(l.firstChild,`rectangle`,{id:s,groupId:c});f.x+=u,f.y+=d,f.metadata={classId:s},r.push(f),Array.from(l.querySelectorAll(`.divider`)).forEach(e=>{let n=L(e,Number(e.getAttribute(`x1`)),Number(e.getAttribute(`y1`)),Number(e.getAttribute(`x2`)),Number(e.getAttribute(`y2`)),{groupId:c,id:t()});n.startX+=u,n.startY+=d,n.endX+=u,n.endY+=d,n.metadata={classId:s},i.push(n)});let p=l.querySelector(`.label`)?.children;if(!p)throw`label nodes not found`;Array.from(p).forEach(e=>{let n=e.textContent;if(!n)return;let r=t(),{transformX:i,transformY:o}=D(e),l=e.getBBox(),f=P(u+i,d+o+10,n,{width:l.width,height:l.height,id:r,groupId:c,metadata:{classId:s}});a.push(f)})}),{nodes:r,lines:i,text:a}},ce=(e,t)=>{let n=[`triangle_outline`,`diamond`,`diamond_outline`],r=t.startArrowhead&&n.includes(t.startArrowhead),i=t.endArrowhead&&n.includes(t.endArrowhead);return!i&&!r?t:(r&&(e===`LR`?t.startX-=Z:e===`RL`?t.startX+=Z:e===`TB`?t.startY-=Z:e===`BT`&&(t.startY+=Z)),i&&(e===`LR`?t.endX+=Z:e===`RL`?t.endX-=Z:e===`TB`?t.endY+=Z:e===`BT`&&(t.endY-=Z)),t)},le=(e,t,n,r)=>{let i=n.querySelector(`.edgePaths`)?.children;if(!i)throw Error(`No Edges found!`);let a=[],o=[];return e.forEach((e,n)=>{let{id1:s,id2:c,relation:l}=e,u=t.find(e=>e.id===s),d=t.find(e=>e.id===c),f=oe(l.lineType),p=Q(l.type1),m=Q(l.type2),h=O(i[n]),g=ce(r,N(h.startX,h.startY,h.endX,h.endY,{strokeStyle:f,startArrowhead:p,endArrowhead:m,label:e.title?{text:e.title}:void 0,start:{type:`rectangle`,id:u.id},end:{type:`rectangle`,id:d.id}}));a.push(g);let{relationTitle1:_,relationTitle2:v}=e,y,b;if(_&&_!==`none`){switch(r){case`TB`:y=g.startX-20,g.endX<g.startX&&(y-=15),b=g.startY+15;break;case`BT`:y=g.startX+20,g.endX>g.startX&&(y+=15),b=g.startY-15;break;case`LR`:y=g.startX+20,b=g.startY+15,g.endY>g.startY&&(b+=15);break;case`RL`:y=g.startX-20,b=g.startY-15,g.startY>g.endY&&(b-=15);break;default:y=g.startX-20,b=g.startY+15}let e=P(y,b,_,{fontSize:16});o.push(e)}if(v&&v!==`none`){switch(r){case`TB`:y=g.endX+20,g.endX<g.startX&&(y+=15),b=g.endY-15;break;case`BT`:y=g.endX-20,g.endX>g.startX&&(y-=15),b=g.endY+15;break;case`LR`:y=g.endX-20,b=g.endY-15,g.endY>g.startY&&(b-=15);break;case`RL`:y=g.endX+20,b=g.endY+15,g.startY>g.endY&&(b+=15);break;default:y=g.endX+20,b=g.endY-15}let e=P(y,b,v,{fontSize:16});o.push(e)}}),{arrows:a,text:o}},$=(e,t,n)=>{let r=[],i=[];return e.forEach(e=>{let{id:a,text:o,class:s}=e,c=t.querySelector(`#${a}`);if(!c)throw Error(`Node with id ${a} not found!`);let{transformX:l,transformY:u}=D(c),d=c.firstChild,f=I(d,`rectangle`,{id:a,subtype:`note`,label:{text:o}});if(Object.assign(f,{x:f.x+l,y:f.y+u}),r.push(f),s){let e=n.find(e=>e.id===s);if(!e)throw Error(`class node with id ${s} not found!`);let t=f.x+(f.width||0)/2,r=f.y+(f.height||0),a=t,o=e.y,c=N(t,r,a,o,{strokeStyle:`dotted`,startArrowhead:null,endArrowhead:null,start:{id:f.id,type:`rectangle`},end:{id:e.id,type:`rectangle`}});i.push(c)}}),{notes:r,connectors:i}};const ue=(e,t)=>{e.parse();let n=e.parser.yy,r=n.getDirection(),i=[],a=[],o=[],s=[],c=n.getNamespaces(),l=n.getClasses();if(Object.keys(l).length){let e=se(l,t);i.push(e.nodes),a.push(...e.lines),o.push(...e.text),s.push(...e.nodes)}let{arrows:u,text:d}=le(n.getRelations(),s,t,r),{notes:f,connectors:p}=$(n.getNotes(),t,s);return i.push(f),u.push(...p),o.push(...d),{type:`class`,nodes:i,lines:a,arrows:u,text:o,namespaces:c}};var de=e=>{let t=e.querySelector(`svg`);if(!t)throw Error(`SVG element not found`);let n=t.getBoundingClientRect(),r=n.width,i=n.height;t.setAttribute(`width`,`${r}`),t.setAttribute(`height`,`${i}`);let a=unescape(encodeURIComponent(t.outerHTML));return{type:`graphImage`,mimeType:`image/svg+xml`,dataURL:`data:image/svg+xml;base64,${btoa(a)}`,width:r,height:i}};const fe=async(e,t=i)=>{n.initialize({...i,...t});let r=await n.mermaidAPI.getDiagramFromText(te(e)),{svg:a}=await n.render(`mermaid-to-excalidraw`,e),o=document.createElement(`div`);o.setAttribute(`style`,`opacity: 0; position: relative; z-index: -1;`),o.innerHTML=a,o.id=`mermaid-diagram`,document.body.appendChild(o);let s;switch(r.type){case`flowchart-v2`:s=re(r,o);break;case`sequence`:s=ae(r,o);break;case`classDiagram`:s=ue(r,o);break;default:s=de(o)}return o.remove(),s};var pe=async(e,t)=>{let n=t||{},r=parseInt(n.themeVariables?.fontSize??``)||20;return T(await fe(e,{...n,themeVariables:{...n.themeVariables,fontSize:`${r*1.25}px`}}),{fontSize:r})};export{pe as parseMermaidToExcalidraw};