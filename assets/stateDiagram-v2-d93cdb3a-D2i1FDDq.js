import"./chakra-ui-DL3iEWi3.js";import{xO as e}from"./excalidraw-D5Q9WXro.js";import"./react-markdown-CPDF2saO.js";import{C as t}from"./app-w2Jd5jCf.js";import{B as n,E as r,Mt as i,c as a,gt as o,u as s,v as c}from"./mermaid-b5860b54-BtaV6srn.js";import"./path-D481w0MF.js";import"./array-C5d_RYS0.js";import"./line-DXOMy9a7.js";import"./_getTag-B_2LHer_.js";import{t as l}from"./graphlib-CE-n686m.js";import"./_baseIsEqual-Dvp7ABzP.js";import"./clone-Ci0bV0Kv.js";import"./createText-2e5e7dd3-DD66Z287.js";import"./edges-e0da2a9e-BDssmOYG.js";import"./dagre-ZPe2a3vH.js";import{t as u}from"./index-3862675e-C8wj6jNB.js";import{a as d,c as f,i as p,n as m,o as h,r as g,s as _,t as v}from"./styles-6aaf32cf-ClRd8tbp.js";i(),e(),o();var y=`rect`,b=`rectWithTitle`,x=`start`,S=`end`,C=`divider`,w=`roundedWithTitle`,T=`note`,E=`noteGroup`,D=`statediagram`,ee=`${D}-state`,O=`transition`,k=`note`,A=`${O} note-edge`,j=`${D}-${k}`,M=`${D}-cluster`,N=`${D}-cluster-alt`,P=`parent`,F=`note`,I=`state`,L=`----`,R=`${L}${F}`,z=`${L}${P}`,B=`fill:none`,V=`fill: #333`,H=`c`,U=`text`,W=`normal`,G={},K=0,q=function(e){let t=Object.keys(e);for(let n of t)e[n]},J=function(e,t){return t.db.extract(t.db.getRootDocV2()),t.db.getClasses()};function Y(e){return e==null?``:e.classes?e.classes.join(` `):``}function X(e=``,t=0,n=``,r=L){return`${I}-${e}${n!==null&&n.length>0?`${r}${n}`:``}-${t}`}var Z=(e,t,n,i,o,s)=>{let l=n.id,u=Y(i[l]);if(l!==`root`){let t=y;n.start===!0&&(t=x),n.start===!1&&(t=S),n.type!==`default`&&(t=n.type),G[l]||(G[l]={id:l,shape:t,description:a.sanitizeText(l,c()),classes:`${u} ${ee}`});let i=G[l];n.description&&(Array.isArray(i.description)?(i.shape=b,i.description.push(n.description)):i.description.length>0?(i.shape=b,i.description===l?i.description=[n.description]:i.description=[i.description,n.description]):(i.shape=y,i.description=n.description),i.description=a.sanitizeTextOrArray(i.description,c())),i.description.length===1&&i.shape===b&&(i.shape=y),!i.type&&n.doc&&(r.info(`Setting cluster for `,l,$(n)),i.type=`group`,i.dir=$(n),i.shape=n.type===`divider`?C:w,i.classes=i.classes+` `+M+` `+(s?N:``));let o={labelStyle:``,shape:i.shape,labelText:i.description,classes:i.classes,style:``,id:l,dir:i.dir,domId:X(l,K),type:i.type,padding:15};if(o.centerLabel=!0,n.note){let t={labelStyle:``,shape:T,labelText:n.note.text,classes:j,style:``,id:l+R+`-`+K,domId:X(l,K,F),type:i.type,padding:15},r={labelStyle:``,shape:E,labelText:n.note.text,classes:i.classes,style:``,id:l+z,domId:X(l,K,P),type:`group`,padding:0};K++;let a=l+z;e.setNode(a,r),e.setNode(t.id,t),e.setNode(l,o),e.setParent(l,a),e.setParent(t.id,a);let s=l,c=t.id;n.note.position===`left of`&&(s=t.id,c=l),e.setEdge(s,c,{arrowhead:`none`,arrowType:``,style:B,labelStyle:``,classes:A,arrowheadStyle:V,labelpos:H,labelType:U,thickness:W})}else e.setNode(l,o)}t&&t.id!==`root`&&(r.trace(`Setting node `,l,` to be child of its parent `,t.id),e.setParent(l,t.id)),n.doc&&(r.trace(`Adding nodes children `),Q(e,n,n.doc,i,o,!s))},Q=(e,t,n,i,o,s)=>{r.trace(`items`,n),n.forEach(n=>{switch(n.stmt){case d:Z(e,t,n,i,o,s);break;case m:Z(e,t,n,i,o,s);break;case p:{Z(e,t,n.state1,i,o,s),Z(e,t,n.state2,i,o,s);let r={id:`edge`+K,arrowhead:`normal`,arrowTypeEnd:`arrow_barb`,style:B,labelStyle:``,label:a.sanitizeText(n.description,c()),arrowheadStyle:V,labelpos:H,labelType:U,thickness:W,classes:O};e.setEdge(n.state1.id,n.state2.id,r,K),K++}break}})},$=(e,t=`TB`)=>{let n=t;if(e.doc)for(let t=0;t<e.doc.length;t++){let r=e.doc[t];r.stmt===`dir`&&(n=r.value)}return n},te={parser:_,db:h,renderer:{setConf:q,getClasses:J,draw:async function(e,i,a,o){r.info(`Drawing state diagram (v2)`,i),G={},o.db.getDirection();let{securityLevel:d,state:f}=c(),p=f.nodeSpacing||50,m=f.rankSpacing||50;r.info(o.db.getRootDocV2()),o.db.extract(o.db.getRootDocV2()),r.info(o.db.getRootDocV2());let h=o.db.getStates(),g=new l({multigraph:!0,compound:!0}).setGraph({rankdir:$(o.db.getRootDocV2()),nodesep:p,ranksep:m,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});Z(g,void 0,o.db.getRootDocV2(),h,o.db,!0);let _;d===`sandbox`&&(_=t(`#i`+i));let v=t(d===`sandbox`?_.nodes()[0].contentDocument.body:`body`),b=v.select(`[id="${i}"]`);await u(v.select(`#`+i+` g`),g,[`barb`],D,i),n.insertTitle(b,`statediagramTitleText`,f.titleTopMargin,o.db.getDiagramTitle());let x=b.node().getBBox(),S=x.width+16,C=x.height+16;b.attr(`class`,D);let w=b.node().getBBox();s(b,C,S,f.useMaxWidth);let T=`${w.x-8} ${w.y-8} ${S} ${C}`;r.debug(`viewBox ${T}`),b.attr(`viewBox`,T);let E=document.querySelectorAll(`[id="`+i+`"] .edgeLabel .label`);for(let e of E){let t=e.getBBox(),n=document.createElementNS(`http://www.w3.org/2000/svg`,y);n.setAttribute(`rx`,0),n.setAttribute(`ry`,0),n.setAttribute(`width`,t.width),n.setAttribute(`height`,t.height),e.insertBefore(n,e.firstChild)}}},styles:f,init:e=>{e.state||={},e.state.arrowMarkerAbsolute=e.arrowMarkerAbsolute,h.clear()}};export{te as diagram};